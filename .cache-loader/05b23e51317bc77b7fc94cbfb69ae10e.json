{"remainingRequest":"D:\\02数文\\WebProject\\NodeAllProject\\FourPano\\node_modules\\babel-loader\\lib\\index.js?cacheDirectory=true!D:\\02数文\\WebProject\\NodeAllProject\\FourPano\\app\\src\\module\\SWCameraModule.js","dependencies":[{"path":"D:\\02数文\\WebProject\\NodeAllProject\\FourPano\\app\\src\\module\\SWCameraModule.js","mtime":1545880788192},{"path":"D:\\02数文\\WebProject\\NodeAllProject\\FourPano\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1540192322431},{"path":"D:\\02数文\\WebProject\\NodeAllProject\\FourPano\\node_modules\\babel-loader\\lib\\index.js","mtime":1520329890000}],"contextDependencies":[],"result":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }(); /* global THREE*/\n\nvar _SWConstants = require('../tool/SWConstants');\n\nvar _SWTool = require('../tool/SWTool');\n\nvar _store = require('../../views/redux/store/store');\n\nvar _store2 = _interopRequireDefault(_store);\n\nvar _action = require('../../views/redux/action');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar TWEEN = require('@tweenjs/tween.js');\n\n/**\r\n * 相机控制类只有旋转和缩放，没有平移\r\n */\n\nvar SWCameraModule = function () {\n\tfunction SWCameraModule() {\n\t\t_classCallCheck(this, SWCameraModule);\n\n\t\t/**相机状态枚举 */\n\t\tthis.STATE = {\n\t\t\tNONE: -1,\n\t\t\tROTATE: 0,\n\t\t\tDOLLY: 1,\n\t\t\tPAN: 2,\n\t\t\tTOUCH_ROTATE: 3,\n\t\t\tTOUCH_DOLLY_PAN: 4\n\t\t};\n\n\t\t/**相机目前状态 */\n\t\tthis.state = this.STATE.NONE;\n\n\t\t/**鼠标按钮 */\n\t\tthis.mouseButtons = {\n\t\t\tORBIT: THREE.MOUSE.LEFT,\n\t\t\tZOOM: THREE.MOUSE.MIDDLE,\n\t\t\tPAN: THREE.MOUSE.RIGHT\n\t\t};\n\n\t\t//这个选项实际上可以使进出进入; 为了向后兼容，保留为“缩放”。\n\t\t/**设置为false以禁用缩放 */\n\t\tthis.enableZoom = true;\n\t\t/**缩放速度 */\n\t\tthis.zoomSpeed = 4.0;\n\n\t\t/**设置为false以禁用旋转 */\n\t\tthis.enableRotate = true;\n\t\t/**旋转速度 */\n\t\tthis.rotateSpeed = 0.4;\n\n\t\t//旋转坐标值\n\t\tthis.rotateStart = new THREE.Vector2();\n\t\tthis.rotateEnd = new THREE.Vector2();\n\t\tthis.rotateDelta = new THREE.Vector2();\n\n\t\tthis.startTime = 0;\n\n\t\tthis.speed = {\n\t\t\tyaw: 0,\n\t\t\tpitch: 0\n\t\t};\n\n\t\t//缩放坐标值\n\t\tthis.dollyStart = new THREE.Vector2();\n\t\tthis.dollyEnd = new THREE.Vector2();\n\t\tthis.dollyDelta = new THREE.Vector2();\n\n\t\tthis.rotateYaw = 0;\n\t\tthis.rotatePitch = 0;\n\n\t\t//围绕Y轴旋转，也叫偏航角\n\t\tthis.yaw_Camera = 0;\n\t\t//围绕X轴旋转，也叫做俯仰角\n\t\tthis.picth_Camera = 0;\n\t\t//围绕Z轴旋转，也叫翻滚角\n\t\tthis.roll_Camera = 0;\n\n\t\tthis.onPointerDownYaw = 0;\n\t\tthis.onPointerDownPitch = 0;\n\t\tthis.config = {\n\t\t\tyaw: 0,\n\t\t\tpitch: 0,\n\t\t\troll: 0,\n\t\t\ttouchPanSpeedCoeffFactor: 1\n\t\t};\n\t\tthis.prevTime;\n\n\t\t/***********************陀螺仪参数**************************** */\n\t\t/**是否启用陀螺仪 */\n\t\tthis.enabledGyro = true;\n\n\t\tthis.deviceOrientation = {};\n\t\tthis.screenOrientation = 0;\n\n\t\tthis.alphaOffset = 0; // radians\n\n\t\tthis.zee = new THREE.Vector3(0, 0, 1);\n\n\t\tthis.euler = new THREE.Euler();\n\n\t\tthis.q0 = new THREE.Quaternion();\n\n\t\tthis.q1 = new THREE.Quaternion(-Math.sqrt(0.5), 0, 0, Math.sqrt(0.5)); // - PI/2 around the x-axis\n\n\t\tthis.startAlpha = 0;\n\t\tthis.startBeta = 0;\n\t\tthis.startGamma = 0;\n\n\t\tthis.lon = this.lat = 0;\n\t\tthis.moothFactor = 10;\n\t\tthis.boundary = 320;\n\t\tthis.lastLon = this.lastLat = undefined;\n\n\t\t/**相机是否推进放大 */\n\t\tthis.ifCameraEnlarge = false;\n\n\t\t/**相机是否在缩放中 */\n\t\tthis.ifCameraRun = false;\n\n\t\tthis.store = (0, _store2.default)();\n\n\t\tthis.setHousesViewAngle(0, 0, true);\n\t}\n\n\t_createClass(SWCameraModule, [{\n\t\tkey: 'update',\n\t\tvalue: function update() {\n\t\t\tthis.config.pitch = Math.max(_SWConstants.c_minPitch, Math.min(_SWConstants.c_maxPitch, this.config.pitch));\n\n\t\t\tthis.setHousesViewAngle(this.config.yaw, this.config.pitch);\n\n\t\t\tif (Math.abs(this.speed.yaw) > 0.01 || Math.abs(this.speed.pitch) > 0.01) {\n\n\t\t\t\tvar prevPitch = this.config.pitch;\n\t\t\t\tvar prevYaw = this.config.yaw;\n\n\t\t\t\tvar newTime = void 0;\n\t\t\t\tif (typeof performance !== 'undefined' && performance.now()) {\n\t\t\t\t\tnewTime = performance.now();\n\t\t\t\t} else {\n\t\t\t\t\tnewTime = Date.now();\n\t\t\t\t}\n\n\t\t\t\tif (this.prevTime === undefined) {\n\t\t\t\t\tthis.prevTime = newTime;\n\t\t\t\t}\n\n\t\t\t\tvar diff = (newTime - this.prevTime) * (_SWConstants.camera.fov + 32) / 1700;\n\t\t\t\tdiff = Math.min(diff, 1.0);\n\n\t\t\t\tthis.prevTime = newTime;\n\n\t\t\t\t// 惯性\n\t\t\t\tif (diff > 0) {\n\t\t\t\t\t// 摩擦\n\t\t\t\t\tvar friction = 0.85;\n\n\t\t\t\t\tthis.config.yaw += this.speed.yaw * diff * friction;\n\t\t\t\t\tthis.config.pitch += this.speed.pitch * diff * friction;\n\n\t\t\t\t\tthis.speed.yaw = this.speed.yaw * 0.8 + (this.config.yaw - prevYaw) / diff * 0.2;\n\t\t\t\t\tthis.speed.pitch = this.speed.pitch * 0.8 + (this.config.pitch - prevPitch) / diff * 0.2;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.prevTime = undefined;\n\t\t\t}\n\t\t}\n\n\t\t/**设置缩放比例 */\n\n\t}, {\n\t\tkey: 'getZoomScale',\n\t\tvalue: function getZoomScale() {\n\t\t\treturn Math.pow(2, this.zoomSpeed);\n\t\t}\n\n\t\t/**缩小 */\n\n\t}, {\n\t\tkey: 'dollyIn',\n\t\tvalue: function dollyIn(dollyScale) {\n\t\t\tvar _this = this;\n\n\t\t\tvar fov = Math.max(_SWConstants.c_Minfov, Math.min(_SWConstants.c_Maxfov, _SWConstants.camera.fov + dollyScale));\n\n\t\t\tvar from = {\n\t\t\t\tx: _SWConstants.camera.fov\n\t\t\t};\n\n\t\t\tvar to = {\n\t\t\t\tx: fov\n\t\t\t};\n\n\t\t\tnew TWEEN.Tween(from).to(to, 800).easing(TWEEN.Easing.Quadratic.Out).onUpdate(function () {\n\t\t\t\t_SWConstants.camera.fov = this._object.x;\n\t\t\t\t_SWConstants.camera.updateProjectionMatrix();\n\t\t\t}).onComplete(function () {\n\t\t\t\t_SWConstants.camera.fov = fov;\n\t\t\t\t_SWConstants.camera.updateProjectionMatrix();\n\t\t\t\tif (_SWConstants.camera.fov > (_SWConstants.c_Maxfov + _SWConstants.c_Minfov) * 0.5) {\n\t\t\t\t\t_this.ifCameraEnlarge = false;\n\n\t\t\t\t\t_SWConstants.sw_skyBox.panoBox.clearFaceTiles();\n\t\t\t\t}\n\t\t\t}).start();\n\t\t}\n\n\t\t/**放大 */\n\n\t}, {\n\t\tkey: 'dollyOut',\n\t\tvalue: function dollyOut(dollyScale) {\n\t\t\tvar fov = Math.max(_SWConstants.c_Minfov, Math.min(_SWConstants.c_Maxfov, _SWConstants.camera.fov - dollyScale));\n\n\t\t\tvar from = {\n\t\t\t\tx: _SWConstants.camera.fov\n\t\t\t};\n\n\t\t\tvar to = {\n\t\t\t\tx: fov\n\t\t\t};\n\n\t\t\tnew TWEEN.Tween(from).to(to, 800).easing(TWEEN.Easing.Quadratic.Out).onUpdate(function () {\n\t\t\t\t_SWConstants.camera.fov = this._object.x;\n\n\t\t\t\t_SWConstants.camera.updateProjectionMatrix();\n\t\t\t}).onComplete(function () {\n\t\t\t\t_SWConstants.camera.fov = fov;\n\n\t\t\t\t_SWConstants.camera.updateProjectionMatrix();\n\t\t\t}).start();\n\t\t}\n\n\t\t/**\r\n   * 鼠标按下\r\n   * @param {MouseEvent} event \r\n   */\n\n\t}, {\n\t\tkey: 'onMouseDown',\n\t\tvalue: function onMouseDown(event) {\n\t\t\tevent.preventDefault();\n\n\t\t\tif (event.button == this.mouseButtons.ORBIT) {\n\t\t\t\tif (this.enableRotate === false) return;\n\n\t\t\t\tthis.rotateStart.set(event.clientX, event.clientY);\n\n\t\t\t\tthis.onPointerDownYaw = this.config.yaw;\n\t\t\t\tthis.onPointerDownPitch = this.config.pitch;\n\n\t\t\t\tthis.speed.pitch = this.speed.yaw = 0;\n\n\t\t\t\tthis.startTime = Date.now();\n\n\t\t\t\tthis.state = this.STATE.ROTATE;\n\n\t\t\t\tthis.update();\n\t\t\t}\n\t\t}\n\n\t\t/**\r\n   * 鼠标移动\r\n   * @param {MouseEvent} event \r\n   */\n\n\t}, {\n\t\tkey: 'onMouseMove',\n\t\tvalue: function onMouseMove(event) {\n\t\t\tevent.preventDefault();\n\n\t\t\tif (this.state == this.STATE.ROTATE) {\n\t\t\t\tif (this.enableRotate === false) return;\n\n\t\t\t\tthis.startTime = Date.now();\n\n\t\t\t\tvar canvasWidth = window.innerWidth;\n\t\t\t\tvar canvasHeight = window.innerHeight;\n\n\t\t\t\tthis.rotateEnd.set(event.clientX, event.clientY);\n\n\t\t\t\tvar yaw = THREE.Math.radToDeg(Math.atan(this.rotateEnd.x / canvasWidth * 2 - 1) - Math.atan(this.rotateStart.x / canvasWidth * 2 - 1)) * ((_SWConstants.camera.fov + 32) / 90);\n\t\t\t\tthis.speed.yaw = yaw * 0.1 * _SWConstants.c_movingSpeedMultiple;\n\t\t\t\tthis.config.yaw += yaw;\n\n\t\t\t\tvar vfov = 2 * THREE.Math.radToDeg(Math.atan(Math.tan((_SWConstants.camera.fov + 32) / 360 * Math.PI) * canvasHeight / canvasWidth));\n\t\t\t\tvar pitch = THREE.Math.radToDeg(Math.atan(this.rotateEnd.y / canvasHeight * 2 - 1) - Math.atan(this.rotateStart.y / canvasHeight * 2 - 1)) * (vfov / 90);\n\n\t\t\t\tthis.speed.pitch = pitch * 0.1 * _SWConstants.c_movingSpeedMultiple;\n\t\t\t\tthis.config.pitch += pitch;\n\n\t\t\t\tthis.rotateStart.x = this.rotateEnd.x;\n\t\t\t\tthis.rotateStart.y = this.rotateEnd.y;\n\t\t\t}\n\t\t}\n\n\t\t/**\r\n   * 鼠标弹起,旋转拖尾效果\r\n   * @param {MouseEvent} event \r\n   */\n\n\t}, {\n\t\tkey: 'onMouseUp',\n\t\tvalue: function onMouseUp(event) {\n\t\t\tif (this.state == this.STATE.ROTATE) {\n\n\t\t\t\tthis.state = this.STATE.NONE;\n\n\t\t\t\tif (Date.now() - this.startTime > 15) {\n\t\t\t\t\tthis.speed.pitch = this.speed.yaw = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\r\n   * 滚轮缩放\r\n   * @param {MouseEvent} event \r\n   */\n\n\t}, {\n\t\tkey: 'onMouseWheel',\n\t\tvalue: function onMouseWheel(event) {\n\t\t\tif (this.enableZoom === false || this.state !== this.STATE.NONE && this.state !== this.STATE.ROTATE) return;\n\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopPropagation();\n\n\t\t\tif (event.deltaY < 0) {\n\t\t\t\tthis.dollyOut(this.getZoomScale());\n\t\t\t} else if (event.deltaY > 0) {\n\t\t\t\tthis.dollyIn(this.getZoomScale());\n\t\t\t}\n\t\t}\n\n\t\t/**\r\n   * 手指按下\r\n   * @param {MouseEvent} event \r\n   */\n\n\t}, {\n\t\tkey: 'onTouchStart',\n\t\tvalue: function onTouchStart(event) {\n\t\t\tevent.preventDefault();\n\n\t\t\tswitch (event.touches.length) {\n\t\t\t\tcase 1:\n\t\t\t\t\t// 单指触摸：旋转\n\t\t\t\t\tif (this.enableRotate === false) return;\n\n\t\t\t\t\tthis.rotateStart.set(event.touches[0].pageX, event.touches[0].pageY);\n\n\t\t\t\t\tthis.startTime = Date.now();\n\n\t\t\t\t\tthis.config.roll = 0;\n\t\t\t\t\tthis.speed.pitch = this.speed.yaw = 0;\n\n\t\t\t\t\tthis.onPointerDownYaw = this.config.yaw;\n\t\t\t\t\tthis.onPointerDownPitch = this.config.pitch;\n\n\t\t\t\t\tthis.state = this.STATE.TOUCH_ROTATE;\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 2:\n\t\t\t\t\t// 双指触摸：移动/缩放\n\t\t\t\t\tif (this.enableZoom === false && this.enablePan === false) return;\n\n\t\t\t\t\tif (this.enableZoom) {\n\t\t\t\t\t\tvar dx = event.touches[0].pageX - event.touches[1].pageX;\n\t\t\t\t\t\tvar dy = event.touches[0].pageY - event.touches[1].pageY;\n\n\t\t\t\t\t\tvar distance = Math.sqrt(dx * dx + dy * dy);\n\n\t\t\t\t\t\tthis.dollyStart.set(0, distance);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.state = this.STATE.TOUCH_DOLLY_PAN;\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tthis.state = this.STATE.NONE;\n\t\t\t}\n\t\t}\n\n\t\t/**\r\n   * 手指移动\r\n   * @param {MouseEvent} event \r\n   */\n\n\t}, {\n\t\tkey: 'onTouchMove',\n\t\tvalue: function onTouchMove(event) {\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopPropagation();\n\n\t\t\tswitch (event.touches.length) {\n\t\t\t\tcase 1:\n\t\t\t\t\t// 单指触摸：旋转\n\t\t\t\t\tif (this.enableRotate === false || this.state !== this.STATE.TOUCH_ROTATE) return;\n\n\t\t\t\t\tthis.startTime = Date.now();\n\n\t\t\t\t\tvar canvasWidth = window.innerWidth;\n\t\t\t\t\tvar canvasHeight = window.innerHeight;\n\n\t\t\t\t\tthis.rotateEnd.set(event.targetTouches[0].clientX, event.targetTouches[0].clientY);\n\n\t\t\t\t\tvar yaw = THREE.Math.radToDeg(Math.atan(this.rotateEnd.x / canvasWidth * 2 - 1) - Math.atan(this.rotateStart.x / canvasWidth * 2 - 1)) * ((_SWConstants.camera.fov + 32) / 90);\n\t\t\t\t\tthis.speed.yaw = yaw * 0.1 * _SWConstants.c_movingSpeedMultiple;\n\t\t\t\t\tthis.config.yaw += yaw;\n\n\t\t\t\t\tvar vfov = 2 * THREE.Math.radToDeg(Math.atan(Math.tan((_SWConstants.camera.fov + 32) / 360 * Math.PI) * canvasHeight / canvasWidth));\n\t\t\t\t\tvar pitch = THREE.Math.radToDeg(Math.atan(this.rotateEnd.y / canvasHeight * 2 - 1) - Math.atan(this.rotateStart.y / canvasHeight * 2 - 1)) * (vfov / 90);\n\n\t\t\t\t\tthis.speed.pitch = pitch * 0.1 * _SWConstants.c_movingSpeedMultiple;\n\t\t\t\t\tthis.config.pitch += pitch;\n\n\t\t\t\t\tthis.rotateStart.x = this.rotateEnd.x;\n\t\t\t\t\tthis.rotateStart.y = this.rotateEnd.y;\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 2:\n\t\t\t\t\t// 双指触摸：移动/缩放\n\t\t\t\t\tif (this.enableZoom === false || this.state !== this.STATE.TOUCH_DOLLY_PAN) return;\n\n\t\t\t\t\tvar dx = event.touches[0].pageX - event.touches[1].pageX;\n\t\t\t\t\tvar dy = event.touches[0].pageY - event.touches[1].pageY;\n\n\t\t\t\t\tvar distance = Math.sqrt(dx * dx + dy * dy);\n\n\t\t\t\t\tthis.dollyEnd.set(0, distance);\n\n\t\t\t\t\tthis.dollyDelta.set(0, (this.dollyEnd.y - this.dollyStart.y) * 8 / this.zoomSpeed);\n\n\t\t\t\t\tthis.dollyIn(-this.dollyDelta.y);\n\n\t\t\t\t\tthis.dollyStart.copy(this.dollyEnd);\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tthis.state = this.STATE.NONE;\n\t\t\t}\n\t\t}\n\n\t\t/**\r\n   * 手指弹起\r\n   * @param {MouseEvent} event \r\n   */\n\n\t}, {\n\t\tkey: 'onTouchEnd',\n\t\tvalue: function onTouchEnd(event) {\n\t\t\tif (event.touches.length === 1) {\n\t\t\t\tthis.state = this.STATE.TOUCH_ROTATE;\n\n\t\t\t\tthis.rotateStart.set(event.touches[0].pageX, event.touches[0].pageY);\n\n\t\t\t\tthis.rotateEnd.set(event.touches[0].pageX, event.touches[0].pageY);\n\t\t\t} else if (event.touches.length === 0) {\n\t\t\t\tthis.state = this.STATE.NONE;\n\n\t\t\t\tif (Date.now() - this.startTime > 150) {\n\t\t\t\t\tthis.speed.pitch = this.speed.yaw = 0;\n\t\t\t\t}\n\t\t\t\tthis.startTime = Date.now();\n\t\t\t}\n\t\t}\n\n\t\t/**\r\n   * 有激光点云时点击墙面会放大\r\n   */\n\n\t}, {\n\t\tkey: 'setWallWheel',\n\t\tvalue: function setWallWheel() {\n\t\t\tif (_SWConstants.camera.isPerspectiveCamera) {\n\t\t\t\tif (_SWConstants.camera.fov > _SWConstants.c_Minfov) {\n\t\t\t\t\tthis.dollyOut((_SWConstants.c_Maxfov - _SWConstants.c_Minfov) / 3); //放大\n\t\t\t\t} else if (_SWConstants.camera.fov == _SWConstants.c_Minfov) {\n\t\t\t\t\tthis.dollyIn(100); //还原\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\r\n   * 这个是直接设置相机视角值\r\n   * @param {*} yaws 经度\r\n   * @param {*} pitch 纬度\r\n   * @param {*} updatas 更新坐标\r\n   */\n\n\t}, {\n\t\tkey: 'setHousesViewAngle',\n\t\tvalue: function setHousesViewAngle(yaws, pitch, updatas) {\n\t\t\tif (this.yaw_Camera == (0, _SWTool.getNumberMax360)(yaws) && this.picth_Camera == pitch) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (yaws || yaws == 0) this.yaw_Camera = (0, _SWTool.getNumberMax360)(yaws); //if(0) => false\n\n\t\t\tif (pitch || pitch == 0) this.picth_Camera = pitch;\n\n\t\t\tif (updatas) {\n\t\t\t\tthis.config.yaw = this.yaw_Camera;\n\t\t\t\tthis.config.pitch = this.picth_Camera;\n\t\t\t}\n\n\t\t\tthis.store.dispatch((0, _action.show_PanoMap_fun)({\n\t\t\t\tradarAngle: this.yaw_Camera\n\t\t\t}));\n\n\t\t\t_SWConstants.camera.lookAt((0, _SWTool.YPRToVector3)(this.yaw_Camera, this.picth_Camera));\n\n\t\t\tif (_SWConstants.sw_skyBox.panoBox) _SWConstants.sw_skyBox.panoBox.addFaceTiles();\n\t\t}\n\n\t\t/**\r\n   * 叠加相机角度\r\n   * @param {*} yaws 经度\r\n   * @param {*} pitch 纬度\r\n   */\n\n\t}, {\n\t\tkey: 'setOverlayViewAngle',\n\t\tvalue: function setOverlayViewAngle(yaws, pitch) {\n\t\t\tvar yawCamera = (0, _SWTool.getNumberMax360)(this.yaw_Camera + yaws);\n\n\t\t\tthis.setHousesViewAngle(yawCamera, pitch, true);\n\t\t}\n\t}]);\n\n\treturn SWCameraModule;\n}();\n\nexports.default = SWCameraModule;",{"version":3,"sources":["app\\src\\module\\SWCameraModule.js"],"names":["TWEEN","require","SWCameraModule","STATE","NONE","ROTATE","DOLLY","PAN","TOUCH_ROTATE","TOUCH_DOLLY_PAN","state","mouseButtons","ORBIT","THREE","MOUSE","LEFT","ZOOM","MIDDLE","RIGHT","enableZoom","zoomSpeed","enableRotate","rotateSpeed","rotateStart","Vector2","rotateEnd","rotateDelta","startTime","speed","yaw","pitch","dollyStart","dollyEnd","dollyDelta","rotateYaw","rotatePitch","yaw_Camera","picth_Camera","roll_Camera","onPointerDownYaw","onPointerDownPitch","config","roll","touchPanSpeedCoeffFactor","prevTime","enabledGyro","deviceOrientation","screenOrientation","alphaOffset","zee","Vector3","euler","Euler","q0","Quaternion","q1","Math","sqrt","startAlpha","startBeta","startGamma","lon","lat","moothFactor","boundary","lastLon","lastLat","undefined","ifCameraEnlarge","ifCameraRun","store","setHousesViewAngle","max","c_minPitch","min","c_maxPitch","abs","prevPitch","prevYaw","newTime","performance","now","Date","diff","camera","fov","friction","pow","dollyScale","c_Minfov","c_Maxfov","from","x","to","Tween","easing","Easing","Quadratic","Out","onUpdate","_object","updateProjectionMatrix","onComplete","sw_skyBox","panoBox","clearFaceTiles","start","event","preventDefault","button","set","clientX","clientY","update","canvasWidth","window","innerWidth","canvasHeight","innerHeight","radToDeg","atan","c_movingSpeedMultiple","vfov","tan","PI","y","stopPropagation","deltaY","dollyOut","getZoomScale","dollyIn","touches","length","pageX","pageY","enablePan","dx","dy","distance","targetTouches","copy","isPerspectiveCamera","yaws","updatas","dispatch","radarAngle","lookAt","addFaceTiles","yawCamera"],"mappings":"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","file":"SWCameraModule.js","sourceRoot":"D:\\02数文\\WebProject\\NodeAllProject\\FourPano","sourcesContent":["/* global THREE*/\r\n\r\nimport {\r\n\tcamera,\r\n\tc_Maxfov,\r\n\tc_Minfov,\r\n\tc_maxPitch,\r\n\tc_minPitch,\r\n\tsw_skyBox,\r\n\tc_movingSpeedMultiple\r\n} from '../tool/SWConstants';\r\nimport {\r\n\tYPRToVector3,\r\n\tgetNumberMax360\r\n} from '../tool/SWTool';\r\nimport initStore from '../../views/redux/store/store';\r\nimport {\r\n\tshow_PanoMap_fun\r\n} from '../../views/redux/action';\r\n\r\nconst TWEEN = require('@tweenjs/tween.js');\r\n\r\n/**\r\n * 相机控制类只有旋转和缩放，没有平移\r\n */\r\nclass SWCameraModule {\r\n\tconstructor() {\r\n\t\t/**相机状态枚举 */\r\n\t\tthis.STATE = {\r\n\t\t\tNONE: -1,\r\n\t\t\tROTATE: 0,\r\n\t\t\tDOLLY: 1,\r\n\t\t\tPAN: 2,\r\n\t\t\tTOUCH_ROTATE: 3,\r\n\t\t\tTOUCH_DOLLY_PAN: 4\r\n\t\t};\r\n\r\n\t\t/**相机目前状态 */\r\n\t\tthis.state = this.STATE.NONE;\r\n\r\n\t\t/**鼠标按钮 */\r\n\t\tthis.mouseButtons = {\r\n\t\t\tORBIT: THREE.MOUSE.LEFT,\r\n\t\t\tZOOM: THREE.MOUSE.MIDDLE,\r\n\t\t\tPAN: THREE.MOUSE.RIGHT\r\n\t\t};\r\n\r\n\t\t//这个选项实际上可以使进出进入; 为了向后兼容，保留为“缩放”。\r\n\t\t/**设置为false以禁用缩放 */\r\n\t\tthis.enableZoom = true;\r\n\t\t/**缩放速度 */\r\n\t\tthis.zoomSpeed = 4.0;\r\n\r\n\t\t/**设置为false以禁用旋转 */\r\n\t\tthis.enableRotate = true;\r\n\t\t/**旋转速度 */\r\n\t\tthis.rotateSpeed = 0.4;\r\n\r\n\t\t//旋转坐标值\r\n\t\tthis.rotateStart = new THREE.Vector2();\r\n\t\tthis.rotateEnd = new THREE.Vector2();\r\n\t\tthis.rotateDelta = new THREE.Vector2();\r\n\r\n\t\tthis.startTime = 0;\r\n\r\n\t\tthis.speed = {\r\n\t\t\tyaw: 0,\r\n\t\t\tpitch: 0\r\n\t\t};\r\n\r\n\t\t//缩放坐标值\r\n\t\tthis.dollyStart = new THREE.Vector2();\r\n\t\tthis.dollyEnd = new THREE.Vector2();\r\n\t\tthis.dollyDelta = new THREE.Vector2();\r\n\r\n\t\tthis.rotateYaw = 0;\r\n\t\tthis.rotatePitch = 0;\r\n\r\n\t\t//围绕Y轴旋转，也叫偏航角\r\n\t\tthis.yaw_Camera = 0;\r\n\t\t//围绕X轴旋转，也叫做俯仰角\r\n\t\tthis.picth_Camera = 0;\r\n\t\t//围绕Z轴旋转，也叫翻滚角\r\n\t\tthis.roll_Camera = 0;\r\n\r\n\t\tthis.onPointerDownYaw = 0;\r\n\t\tthis.onPointerDownPitch = 0;\r\n\t\tthis.config = {\r\n\t\t\tyaw: 0,\r\n\t\t\tpitch: 0,\r\n\t\t\troll: 0,\r\n\t\t\ttouchPanSpeedCoeffFactor: 1\r\n\t\t};\r\n\t\tthis.prevTime;\r\n\r\n\t\t/***********************陀螺仪参数**************************** */\r\n\t\t/**是否启用陀螺仪 */\r\n\t\tthis.enabledGyro = true;\r\n\r\n\t\tthis.deviceOrientation = {};\r\n\t\tthis.screenOrientation = 0;\r\n\r\n\t\tthis.alphaOffset = 0; // radians\r\n\r\n\t\tthis.zee = new THREE.Vector3(0, 0, 1);\r\n\r\n\t\tthis.euler = new THREE.Euler();\r\n\r\n\t\tthis.q0 = new THREE.Quaternion();\r\n\r\n\t\tthis.q1 = new THREE.Quaternion(-Math.sqrt(0.5), 0, 0, Math.sqrt(0.5)); // - PI/2 around the x-axis\r\n\r\n\t\tthis.startAlpha = 0;\r\n\t\tthis.startBeta = 0;\r\n\t\tthis.startGamma = 0;\r\n\r\n\t\tthis.lon = this.lat = 0;\r\n\t\tthis.moothFactor = 10;\r\n\t\tthis.boundary = 320;\r\n\t\tthis.lastLon = this.lastLat = undefined;\r\n\r\n\t\t/**相机是否推进放大 */\r\n\t\tthis.ifCameraEnlarge = false;\r\n\r\n\t\t/**相机是否在缩放中 */\r\n\t\tthis.ifCameraRun = false;\r\n\r\n\t\tthis.store = initStore();\r\n\r\n\t\tthis.setHousesViewAngle(0, 0, true);\r\n\t}\r\n\r\n\tupdate() {\r\n\t\tthis.config.pitch = Math.max(c_minPitch, Math.min(c_maxPitch, this.config.pitch));\r\n\r\n\t\tthis.setHousesViewAngle(this.config.yaw, this.config.pitch);\r\n\r\n\t\tif (Math.abs(this.speed.yaw) > 0.01 || Math.abs(this.speed.pitch) > 0.01) {\r\n\r\n\t\t\tlet prevPitch = this.config.pitch;\r\n\t\t\tlet prevYaw = this.config.yaw;\r\n\r\n\t\t\tlet newTime;\r\n\t\t\tif (typeof performance !== 'undefined' && performance.now()) {\r\n\t\t\t\tnewTime = performance.now();\r\n\t\t\t} else {\r\n\t\t\t\tnewTime = Date.now();\r\n\t\t\t}\r\n\r\n\t\t\tif (this.prevTime === undefined) {\r\n\t\t\t\tthis.prevTime = newTime;\r\n\t\t\t}\r\n\r\n\t\t\tlet diff = (newTime - this.prevTime) * (camera.fov + 32) / 1700;\r\n\t\t\tdiff = Math.min(diff, 1.0);\r\n\r\n\t\t\tthis.prevTime = newTime;\r\n\r\n\t\t\t// 惯性\r\n\t\t\tif (diff > 0) {\r\n\t\t\t\t// 摩擦\r\n\t\t\t\tlet friction = 0.85;\r\n\r\n\t\t\t\tthis.config.yaw += this.speed.yaw * diff * friction;\r\n\t\t\t\tthis.config.pitch += this.speed.pitch * diff * friction;\r\n\r\n\t\t\t\tthis.speed.yaw = this.speed.yaw * 0.8 + (this.config.yaw - prevYaw) / diff * 0.2;\r\n\t\t\t\tthis.speed.pitch = this.speed.pitch * 0.8 + (this.config.pitch - prevPitch) / diff * 0.2;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis.prevTime = undefined;\r\n\t\t}\r\n\t}\r\n\r\n\t/**设置缩放比例 */\r\n\tgetZoomScale() {\r\n\t\treturn Math.pow(2, this.zoomSpeed);\r\n\t}\r\n\r\n\t/**缩小 */\r\n\tdollyIn(dollyScale) {\r\n\t\tlet fov = Math.max(c_Minfov, Math.min(c_Maxfov, camera.fov + dollyScale));\r\n\r\n\t\tlet from = {\r\n\t\t\tx: camera.fov\r\n\t\t};\r\n\r\n\t\tlet to = {\r\n\t\t\tx: fov\r\n\t\t};\r\n\r\n\t\tnew TWEEN.Tween(from)\r\n\t\t\t.to(to, 800)\r\n\t\t\t.easing(TWEEN.Easing.Quadratic.Out)\r\n\t\t\t.onUpdate(function () {\r\n\t\t\t\tcamera.fov = this._object.x;\r\n\t\t\t\tcamera.updateProjectionMatrix();\r\n\t\t\t})\r\n\t\t\t.onComplete(() => {\r\n\t\t\t\tcamera.fov = fov;\r\n\t\t\t\tcamera.updateProjectionMatrix();\r\n\t\t\t\tif (camera.fov > (c_Maxfov + c_Minfov) * 0.5) {\r\n\t\t\t\t\tthis.ifCameraEnlarge = false;\r\n\r\n\t\t\t\t\tsw_skyBox.panoBox.clearFaceTiles();\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.start();\r\n\t}\r\n\r\n\t/**放大 */\r\n\tdollyOut(dollyScale) {\r\n\t\tlet fov = Math.max(c_Minfov, Math.min(c_Maxfov, camera.fov - dollyScale));\r\n\r\n\t\tlet from = {\r\n\t\t\tx: camera.fov\r\n\t\t};\r\n\r\n\t\tlet to = {\r\n\t\t\tx: fov\r\n\t\t};\r\n\r\n\t\tnew TWEEN.Tween(from)\r\n\t\t\t.to(to, 800)\r\n\t\t\t.easing(TWEEN.Easing.Quadratic.Out)\r\n\t\t\t.onUpdate(function () {\r\n\t\t\t\tcamera.fov = this._object.x;\r\n\r\n\t\t\t\tcamera.updateProjectionMatrix();\r\n\t\t\t})\r\n\t\t\t.onComplete(() => {\r\n\t\t\t\tcamera.fov = fov;\r\n\r\n\t\t\t\tcamera.updateProjectionMatrix();\r\n\t\t\t})\r\n\t\t\t.start();\r\n\t}\r\n\r\n\t/**\r\n\t * 鼠标按下\r\n\t * @param {MouseEvent} event \r\n\t */\r\n\tonMouseDown(event) {\r\n\t\tevent.preventDefault();\r\n\r\n\t\tif (event.button == this.mouseButtons.ORBIT) {\r\n\t\t\tif (this.enableRotate === false) return;\r\n\r\n\t\t\tthis.rotateStart.set(event.clientX, event.clientY);\r\n\r\n\t\t\tthis.onPointerDownYaw = this.config.yaw;\r\n\t\t\tthis.onPointerDownPitch = this.config.pitch;\r\n\r\n\t\t\tthis.speed.pitch = this.speed.yaw = 0;\r\n\r\n\t\t\tthis.startTime = Date.now();\r\n\r\n\t\t\tthis.state = this.STATE.ROTATE;\r\n\r\n\t\t\tthis.update();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 鼠标移动\r\n\t * @param {MouseEvent} event \r\n\t */\r\n\tonMouseMove(event) {\r\n\t\tevent.preventDefault();\r\n\r\n\t\tif (this.state == this.STATE.ROTATE) {\r\n\t\t\tif (this.enableRotate === false) return;\r\n\r\n\t\t\tthis.startTime = Date.now();\r\n\r\n\t\t\tlet canvasWidth = window.innerWidth;\r\n\t\t\tlet canvasHeight = window.innerHeight;\r\n\r\n\t\t\tthis.rotateEnd.set(event.clientX, event.clientY);\r\n\r\n\t\t\tlet yaw = THREE.Math.radToDeg(Math.atan(this.rotateEnd.x / canvasWidth * 2 - 1) - Math.atan(this.rotateStart.x / canvasWidth * 2 - 1)) * ((camera.fov + 32) / 90);\r\n\t\t\tthis.speed.yaw = yaw * 0.1 * c_movingSpeedMultiple;\r\n\t\t\tthis.config.yaw += yaw;\r\n\r\n\t\t\tlet vfov = 2 * THREE.Math.radToDeg(Math.atan(Math.tan((camera.fov + 32) / 360 * Math.PI) * canvasHeight / canvasWidth));\r\n\t\t\tlet pitch = THREE.Math.radToDeg(Math.atan(this.rotateEnd.y / canvasHeight * 2 - 1) - Math.atan(this.rotateStart.y / canvasHeight * 2 - 1)) * (vfov / 90);\r\n\r\n\t\t\tthis.speed.pitch = pitch * 0.1 * c_movingSpeedMultiple;\r\n\t\t\tthis.config.pitch += pitch;\r\n\r\n\t\t\tthis.rotateStart.x = this.rotateEnd.x;\r\n\t\t\tthis.rotateStart.y = this.rotateEnd.y;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 鼠标弹起,旋转拖尾效果\r\n\t * @param {MouseEvent} event \r\n\t */\r\n\tonMouseUp(event) {\r\n\t\tif (this.state == this.STATE.ROTATE) {\r\n\r\n\t\t\tthis.state = this.STATE.NONE;\r\n\r\n\t\t\tif (Date.now() - this.startTime > 15) {\r\n\t\t\t\tthis.speed.pitch = this.speed.yaw = 0;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 滚轮缩放\r\n\t * @param {MouseEvent} event \r\n\t */\r\n\tonMouseWheel(event) {\r\n\t\tif (this.enableZoom === false || (this.state !== this.STATE.NONE && this.state !== this.STATE.ROTATE)) return;\r\n\r\n\t\tevent.preventDefault();\r\n\t\tevent.stopPropagation();\r\n\r\n\t\tif (event.deltaY < 0) {\r\n\t\t\tthis.dollyOut(this.getZoomScale());\r\n\t\t} else if (event.deltaY > 0) {\r\n\t\t\tthis.dollyIn(this.getZoomScale());\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 手指按下\r\n\t * @param {MouseEvent} event \r\n\t */\r\n\tonTouchStart(event) {\r\n\t\tevent.preventDefault();\r\n\r\n\t\tswitch (event.touches.length) {\r\n\t\t\tcase 1: // 单指触摸：旋转\r\n\t\t\t\tif (this.enableRotate === false) return;\r\n\r\n\t\t\t\tthis.rotateStart.set(event.touches[0].pageX, event.touches[0].pageY);\r\n\r\n\t\t\t\tthis.startTime = Date.now();\r\n\r\n\t\t\t\tthis.config.roll = 0;\r\n\t\t\t\tthis.speed.pitch = this.speed.yaw = 0;\r\n\r\n\t\t\t\tthis.onPointerDownYaw = this.config.yaw;\r\n\t\t\t\tthis.onPointerDownPitch = this.config.pitch;\r\n\r\n\t\t\t\tthis.state = this.STATE.TOUCH_ROTATE;\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 2: // 双指触摸：移动/缩放\r\n\t\t\t\tif (this.enableZoom === false && this.enablePan === false) return;\r\n\r\n\t\t\t\tif (this.enableZoom) {\r\n\t\t\t\t\tlet dx = event.touches[0].pageX - event.touches[1].pageX;\r\n\t\t\t\t\tlet dy = event.touches[0].pageY - event.touches[1].pageY;\r\n\r\n\t\t\t\t\tlet distance = Math.sqrt(dx * dx + dy * dy);\r\n\r\n\t\t\t\t\tthis.dollyStart.set(0, distance);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.state = this.STATE.TOUCH_DOLLY_PAN;\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\t\t\t\tthis.state = this.STATE.NONE;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 手指移动\r\n\t * @param {MouseEvent} event \r\n\t */\r\n\tonTouchMove(event) {\r\n\t\tevent.preventDefault();\r\n\t\tevent.stopPropagation();\r\n\r\n\t\tswitch (event.touches.length) {\r\n\t\t\tcase 1: // 单指触摸：旋转\r\n\t\t\t\tif (this.enableRotate === false || this.state !== this.STATE.TOUCH_ROTATE) return;\r\n\r\n\t\t\t\tthis.startTime = Date.now();\r\n\r\n\t\t\t\tlet canvasWidth = window.innerWidth;\r\n\t\t\t\tlet canvasHeight = window.innerHeight;\r\n\r\n\t\t\t\tthis.rotateEnd.set(event.targetTouches[0].clientX, event.targetTouches[0].clientY);\r\n\r\n\t\t\t\tlet yaw = THREE.Math.radToDeg(Math.atan(this.rotateEnd.x / canvasWidth * 2 - 1) - Math.atan(this.rotateStart.x / canvasWidth * 2 - 1)) * ((camera.fov + 32) / 90);\r\n\t\t\t\tthis.speed.yaw = yaw * 0.1 * c_movingSpeedMultiple;\r\n\t\t\t\tthis.config.yaw += yaw;\r\n\r\n\t\t\t\tlet vfov = 2 * THREE.Math.radToDeg(Math.atan(Math.tan((camera.fov + 32) / 360 * Math.PI) * canvasHeight / canvasWidth));\r\n\t\t\t\tlet pitch = THREE.Math.radToDeg(Math.atan(this.rotateEnd.y / canvasHeight * 2 - 1) - Math.atan(this.rotateStart.y / canvasHeight * 2 - 1)) * (vfov / 90);\r\n\r\n\t\t\t\tthis.speed.pitch = pitch * 0.1 * c_movingSpeedMultiple;\r\n\t\t\t\tthis.config.pitch += pitch;\r\n\r\n\t\t\t\tthis.rotateStart.x = this.rotateEnd.x;\r\n\t\t\t\tthis.rotateStart.y = this.rotateEnd.y;\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 2: // 双指触摸：移动/缩放\r\n\t\t\t\tif (this.enableZoom === false || this.state !== this.STATE.TOUCH_DOLLY_PAN) return;\r\n\r\n\t\t\t\tlet dx = event.touches[0].pageX - event.touches[1].pageX;\r\n\t\t\t\tlet dy = event.touches[0].pageY - event.touches[1].pageY;\r\n\r\n\t\t\t\tlet distance = Math.sqrt(dx * dx + dy * dy);\r\n\r\n\t\t\t\tthis.dollyEnd.set(0, distance);\r\n\r\n\t\t\t\tthis.dollyDelta.set(0, (this.dollyEnd.y - this.dollyStart.y) * 8 / this.zoomSpeed);\r\n\r\n\t\t\t\tthis.dollyIn(-this.dollyDelta.y);\r\n\r\n\t\t\t\tthis.dollyStart.copy(this.dollyEnd);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\t\t\t\tthis.state = this.STATE.NONE;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 手指弹起\r\n\t * @param {MouseEvent} event \r\n\t */\r\n\tonTouchEnd(event) {\r\n\t\tif (event.touches.length === 1) {\r\n\t\t\tthis.state = this.STATE.TOUCH_ROTATE;\r\n\r\n\t\t\tthis.rotateStart.set(event.touches[0].pageX, event.touches[0].pageY);\r\n\r\n\t\t\tthis.rotateEnd.set(event.touches[0].pageX, event.touches[0].pageY);\r\n\t\t} else if (event.touches.length === 0) {\r\n\t\t\tthis.state = this.STATE.NONE;\r\n\r\n\t\t\tif (Date.now() - this.startTime > 150) {\r\n\t\t\t\tthis.speed.pitch = this.speed.yaw = 0;\r\n\t\t\t}\r\n\t\t\tthis.startTime = Date.now();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 有激光点云时点击墙面会放大\r\n\t */\r\n\tsetWallWheel() {\r\n\t\tif (camera.isPerspectiveCamera) {\r\n\t\t\tif (camera.fov > c_Minfov) {\r\n\t\t\t\tthis.dollyOut((c_Maxfov - c_Minfov) / 3); //放大\r\n\t\t\t} else if (camera.fov == c_Minfov) {\r\n\t\t\t\tthis.dollyIn(100); //还原\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 这个是直接设置相机视角值\r\n\t * @param {*} yaws 经度\r\n\t * @param {*} pitch 纬度\r\n\t * @param {*} updatas 更新坐标\r\n\t */\r\n\tsetHousesViewAngle(yaws, pitch, updatas) {\r\n\t\tif (this.yaw_Camera == getNumberMax360(yaws) && this.picth_Camera == pitch) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (yaws || yaws == 0) this.yaw_Camera = getNumberMax360(yaws); //if(0) => false\r\n\r\n\t\tif (pitch || pitch == 0) this.picth_Camera = pitch;\r\n\r\n\t\tif (updatas) {\r\n\t\t\tthis.config.yaw = this.yaw_Camera;\r\n\t\t\tthis.config.pitch = this.picth_Camera;\r\n\t\t}\r\n\r\n\t\tthis.store.dispatch(\r\n\t\t\tshow_PanoMap_fun({\r\n\t\t\t\tradarAngle: this.yaw_Camera\r\n\t\t\t})\r\n\t\t);\r\n\r\n\t\tcamera.lookAt(YPRToVector3(this.yaw_Camera, this.picth_Camera));\r\n\r\n\t\tif(sw_skyBox.panoBox)sw_skyBox.panoBox.addFaceTiles();\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * 叠加相机角度\r\n\t * @param {*} yaws 经度\r\n\t * @param {*} pitch 纬度\r\n\t */\r\n\tsetOverlayViewAngle(yaws, pitch) {\r\n\t\tlet yawCamera = getNumberMax360(this.yaw_Camera + yaws);\r\n\r\n\t\tthis.setHousesViewAngle(yawCamera, pitch, true);\r\n\t}\r\n}\r\n\r\nexport default SWCameraModule;"]}]}