{"remainingRequest":"D:\\02数文\\WebProject\\NodeAllProject\\FourPano\\node_modules\\babel-loader\\lib\\index.js?cacheDirectory=true!D:\\02数文\\WebProject\\NodeAllProject\\FourPano\\app\\src\\module\\marker\\SWMarkerModule.js","dependencies":[{"path":"D:\\02数文\\WebProject\\NodeAllProject\\FourPano\\app\\src\\module\\marker\\SWMarkerModule.js","mtime":1541411358830},{"path":"D:\\02数文\\WebProject\\NodeAllProject\\FourPano\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1540192322431},{"path":"D:\\02数文\\WebProject\\NodeAllProject\\FourPano\\node_modules\\babel-loader\\lib\\index.js","mtime":1520329890000}],"contextDependencies":[],"result":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }(); /* global THREE,$*/\n\nvar _SWTool = require('../../tool/SWTool');\n\nvar _SWTextureAnimator = require('../../tool/SWTextureAnimator');\n\nvar _SWTextureAnimator2 = _interopRequireDefault(_SWTextureAnimator);\n\nvar _store = require('../../../views/redux/store/store');\n\nvar _store2 = _interopRequireDefault(_store);\n\nvar _action = require('../../../views/redux/action');\n\nvar _SWInitializeInstance = require('../../tool/SWInitializeInstance');\n\nvar _SWConstants = require('../../tool/SWConstants');\n\nvar constants = _interopRequireWildcard(_SWConstants);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n/**\r\n * 全景除了底层盒子、UI 都是标注\r\n * 这是所有标注的父类\r\n */\nvar SWMarkerModule = function () {\n    /**\r\n     * \r\n     * @param {String} url 图片链接地址\r\n     * @param {Number} type 1-静态 2-动态 \r\n     * @param {Object} obj {fpsNum:帧数，wPlane:宽，hPlane：高}\r\n     */\n    function SWMarkerModule(url, type, obj) {\n        _classCallCheck(this, SWMarkerModule);\n\n        this.markerType = type;\n\n        this.mouseDownBoo = false;\n\n        this.startPoint = new THREE.Vector2();\n\n        if (url) {\n            this.texture = new THREE.ImageUtils.loadTexture(url);\n        }\n\n        if (obj) {\n            this.textureAnimator = new _SWTextureAnimator2.default(this.texture, obj.fpsNum, 1, obj.fpsNum, 100);\n\n            this.geometry = new THREE.PlaneGeometry(obj.wPlane, obj.hPlane, 1, 1);\n\n            this.material = new THREE.MeshBasicMaterial({\n                map: this.texture,\n                side: 2,\n                transparent: true,\n                opacity: 1\n            });\n        } else {\n\n            this.geometry = new THREE.PlaneGeometry(1, 1, 1, 1);\n\n            this.material = new THREE.MeshBasicMaterial({\n                color: 0xFFFFFF\n            });\n        }\n\n        this.mesh = new THREE.Mesh(this.geometry, this.material);\n\n        // this.textDiv = new TextDiv(new THREE.Vector3(0, 0, 0), 12, \"\");\n        // this.textDiv.id = \"markerMesh\";\n        // this.textDiv.style.display = \"none\";\n        // this.textDiv.style.color = \"#FFF\";\n        // this.textDiv.style.borderRadius = \"3px\";\n        // this.textDiv.style.backgroundColor = \"rgba(16, 16, 16, 0.3)\";\n        // this.textDiv.style.padding = \"3px 10px\";\n        // this.textDiv.style.letterSpacing = \"2px\";\n        this.textDiv = new _SWTool.TextDiv(new THREE.Vector3(0, 0, 0));\n\n        this.textDiv.id = \"markerArrowMesh\";\n\n        this.textDiv.style.fontFamily = \"Arial\";\n\n        this.textDiv.style.display = \"none\";\n\n        this.textDiv.style.padding = \"4px\";\n\n        this.textDiv.style.backgroundColor = \"rgba(0, 0, 0, 0.5)\";\n\n        this.textDiv.style.letterSpacing = \"2px\";\n\n        this.textDiv.style.border = \"1px solid rgba(255, 255, 255, 0.5)\";\n\n        this.textDiv.style.borderRadius = \"5px\";\n    }\n\n    /**\r\n     * 添加鼠标事件\r\n     */\n\n\n    _createClass(SWMarkerModule, [{\n        key: 'addMouseEvent',\n        value: function addMouseEvent() {\n            var _this = this;\n\n            this.mesh.mouseDown = function (e, obj) {\n\n                _this.mouseDownBoo = true;\n\n                _this.startPoint.x = e.clientX;\n\n                _this.startPoint.y = e.clientY;\n            };\n\n            this.mesh.mouseUp = function (e, obj) {\n\n                if (_this.mouseDownBoo) {\n\n                    var v3 = new THREE.Vector2(e.clientX, e.clientY);\n\n                    var boo = v3.equals(_this.startPoint);\n\n                    _this.mouseDownBoo = false;\n\n                    if (boo) {\n                        var store = (0, _store2.default)();\n                        var url = void 0;\n                        switch (_this.markerObj.type) {//点击弹出的表现形式 1-图文 2-图片 3-三维 4-视频 5-书籍 6-音频 7-环拍 999-跳站点\n                            case 1:\n                            case 2:\n                                var allExhibits = constants.c_allExhibitsForBuildingTable.getValues();\n\n                                allExhibits.forEach(function (item) {\n\n                                    if (item.markerID.indexOf(obj.object.userData.markerID) != -1) {\n\n                                        if (!constants.c_multiDataByParentIDTable.containsKey(item.exhibitID)) {\n\n                                            if (_this.markerObj.type == 1) {\n\n                                                _this.showMarkerUI(item, []);\n                                            }\n\n                                            constants.sw_getService.getMultiDataByParentID(item.exhibitID, _this.markerObj.type);\n                                        } else {\n\n                                            var imageArr = constants.c_multiDataByParentIDTable.getValue(item.exhibitID);\n\n                                            if (_this.markerObj.type == 1) {\n\n                                                _this.showMarkerUI(item, imageArr);\n                                            } else {\n\n                                                var markerImgList = [],\n                                                    markerthumbs = [];\n\n                                                imageArr.forEach(function (item) {\n                                                    var imgUrl = constants.sw_getService.resourcesUrl + '/' + item.filePath;\n\n                                                    var arr1 = item.filePath.split('/');\n\n                                                    var pp = constants.sw_getService.resourcesUrl + '/' + arr1[0] + '/' + arr1[1] + '/' + arr1[2] + '/phone/' + arr1[3];\n\n                                                    markerImgList.push(imgUrl);\n\n                                                    markerthumbs.push(pp);\n                                                });\n                                                store.dispatch((0, _action.show_ViewPicture_fun)({\n                                                    off: true,\n                                                    idx: 0,\n                                                    imageList: markerImgList,\n                                                    thumbs: markerthumbs\n                                                }));\n                                            }\n                                        }\n                                    }\n                                });\n                                break;\n                            case 3:\n                                url = constants.sw_getService.resourcesUrl + \"/BusinessData/ExhibitDetails/3DModel/\" + _this.markerObj.markerID + \".html\";\n\n                                store.dispatch((0, _action.show_Iframe_fun)({\n                                    iframeOff: true,\n                                    iframeUrl: url\n                                }));\n                                break;\n                            case 4:\n                                store.dispatch((0, _action.show_VideoBox_fun)({\n                                    off: true,\n                                    videoUrl: _this.markerObj.name\n                                }));\n                                break;\n                            case 5:\n                                url = constants.sw_getService.resourcesUrl + \"/BusinessData/ExhibitDetails/Book/\" + _this.markerObj.markerID + \"/index.html\";\n\n                                store.dispatch((0, _action.show_Iframe_fun)({\n                                    iframeOff: true,\n                                    iframeUrl: url\n                                }));\n                                break;\n                            case 999:\n                                (0, _SWInitializeInstance.jumpSite)(_this.markerObj.name);\n                                break;\n                        }\n                    }\n                }\n            };\n\n            //鼠标进入\n            this.mesh.mouseOver = function (e, obj) {\n\n                _this.showTextDiv(obj, _this.markerObj.name);\n            };\n\n            //出去\n            this.mesh.mouseOut = function (e, obj) {\n\n                _this.hideTextDiv();\n            };\n        }\n\n        /**显示标注UI界面 */\n\n    }, {\n        key: 'showMarkerUI',\n        value: function showMarkerUI(item, imageArr) {\n            var store = (0, _store2.default)();\n            store.dispatch((0, _action.show_MarkerInterface_fun)({\n                off: true,\n                exhibitID: item.exhibitID,\n                imglist: imageArr,\n                title: item.name,\n                content: item.description,\n                d3: item.featuresList[0],\n                video: item.featuresList[1],\n                audio: item.featuresList[2],\n                book: item.featuresList[3],\n                links: item.featuresList[4],\n                likeNum: item.likes\n            }));\n            constants.c_likeToExhibitID = item.exhibitID;\n            constants.sw_getService.GetLikesForExhibitID(item.exhibitID); //获取点赞数\n            constants.sw_getService.GetNewestComment(item.exhibitID); //获取最新20条评论\n        }\n\n        /**\r\n         * 不停的更新动画\r\n         * @param {Number} delta 补帧时间\r\n         */\n\n    }, {\n        key: 'update',\n        value: function update(delta) {\n            if (this.textureAnimator && this.markerType == 2) {\n\n                this.textureAnimator.update(1000 * delta);\n            }\n        }\n\n        /**\r\n         * 显示标注文本说明\r\n         * @param {Object} obj 射线返回对象\r\n         * @param {String} str 显示文本\r\n         */\n\n    }, {\n        key: 'showTextDiv',\n        value: function showTextDiv(obj, str) {\n            if (str && str != \"\") {\n\n                this.textDiv.style.display = \"block\";\n\n                var labelPos = (0, _SWTool.getWorldToScene)(obj.point);\n\n                this.textDiv.style.left = labelPos.x + \"px\";\n\n                this.textDiv.style.top = labelPos.y - 40 + \"px\";\n\n                this.textDiv.innerHTML = str;\n            }\n        }\n\n        /**隐藏标注说明文本 */\n\n    }, {\n        key: 'hideTextDiv',\n        value: function hideTextDiv() {\n\n            this.textDiv.style.display = \"none\";\n        }\n\n        /**清空对象 */\n\n    }, {\n        key: 'clear',\n        value: function clear() {\n\n            this.textureAnimator = null;\n\n            (0, _SWTool.delectTextDiv)(this.textDiv);\n\n            (0, _SWTool.disposeNode)(this.mesh);\n        }\n    }]);\n\n    return SWMarkerModule;\n}();\n\nexports.default = SWMarkerModule;",{"version":3,"sources":["app\\src\\module\\marker\\SWMarkerModule.js"],"names":["constants","SWMarkerModule","url","type","obj","markerType","mouseDownBoo","startPoint","THREE","Vector2","texture","ImageUtils","loadTexture","textureAnimator","SWTextureAnimator","fpsNum","geometry","PlaneGeometry","wPlane","hPlane","material","MeshBasicMaterial","map","side","transparent","opacity","color","mesh","Mesh","textDiv","TextDiv","Vector3","id","style","fontFamily","display","padding","backgroundColor","letterSpacing","border","borderRadius","mouseDown","e","x","clientX","y","clientY","mouseUp","v3","boo","equals","store","markerObj","allExhibits","c_allExhibitsForBuildingTable","getValues","forEach","item","markerID","indexOf","object","userData","c_multiDataByParentIDTable","containsKey","exhibitID","showMarkerUI","sw_getService","getMultiDataByParentID","imageArr","getValue","markerImgList","markerthumbs","imgUrl","resourcesUrl","filePath","arr1","split","pp","push","dispatch","off","idx","imageList","thumbs","iframeOff","iframeUrl","videoUrl","name","mouseOver","showTextDiv","mouseOut","hideTextDiv","imglist","title","content","description","d3","featuresList","video","audio","book","links","likeNum","likes","c_likeToExhibitID","GetLikesForExhibitID","GetNewestComment","delta","update","str","labelPos","point","left","top","innerHTML"],"mappings":"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","file":"SWMarkerModule.js","sourceRoot":"D:\\02数文\\WebProject\\NodeAllProject\\FourPano","sourcesContent":["/* global THREE,$*/\r\n\r\nimport {\r\n    disposeNode,\r\n    TextDiv,\r\n    getWorldToScene,\r\n    delectTextDiv\r\n} from '../../tool/SWTool'\r\nimport SWTextureAnimator from '../../tool/SWTextureAnimator';\r\nimport initStore from '../../../views/redux/store/store';\r\nimport {\r\n    show_Iframe_fun,\r\n    show_VideoBox_fun,\r\n    show_MarkerInterface_fun,\r\n    show_ViewPicture_fun\r\n} from '../../../views/redux/action';\r\nimport {\r\n    jumpSite\r\n} from '../../tool/SWInitializeInstance';\r\nimport * as constants from '../../tool/SWConstants';\r\n\r\n/**\r\n * 全景除了底层盒子、UI 都是标注\r\n * 这是所有标注的父类\r\n */\r\nclass SWMarkerModule {\r\n    /**\r\n     * \r\n     * @param {String} url 图片链接地址\r\n     * @param {Number} type 1-静态 2-动态 \r\n     * @param {Object} obj {fpsNum:帧数，wPlane:宽，hPlane：高}\r\n     */\r\n    constructor(url, type, obj) {\r\n\r\n        this.markerType = type;\r\n\r\n        this.mouseDownBoo = false;\r\n\r\n        this.startPoint = new THREE.Vector2();\r\n\r\n        if (url) {\r\n            this.texture = new THREE.ImageUtils.loadTexture(url);\r\n        }\r\n\r\n        if (obj) {\r\n            this.textureAnimator = new SWTextureAnimator(this.texture, obj.fpsNum, 1, obj.fpsNum, 100);\r\n\r\n            this.geometry = new THREE.PlaneGeometry(obj.wPlane, obj.hPlane, 1, 1);\r\n\r\n            this.material = new THREE.MeshBasicMaterial({\r\n                map: this.texture,\r\n                side: 2,\r\n                transparent: true,\r\n                opacity: 1\r\n            });\r\n\r\n        } else {\r\n\r\n            this.geometry = new THREE.PlaneGeometry(1, 1, 1, 1);\r\n\r\n            this.material = new THREE.MeshBasicMaterial({\r\n                color: 0xFFFFFF\r\n            });\r\n\r\n        }\r\n\r\n        this.mesh = new THREE.Mesh(this.geometry, this.material);\r\n\r\n        // this.textDiv = new TextDiv(new THREE.Vector3(0, 0, 0), 12, \"\");\r\n        // this.textDiv.id = \"markerMesh\";\r\n        // this.textDiv.style.display = \"none\";\r\n        // this.textDiv.style.color = \"#FFF\";\r\n        // this.textDiv.style.borderRadius = \"3px\";\r\n        // this.textDiv.style.backgroundColor = \"rgba(16, 16, 16, 0.3)\";\r\n        // this.textDiv.style.padding = \"3px 10px\";\r\n        // this.textDiv.style.letterSpacing = \"2px\";\r\n        this.textDiv = new TextDiv(new THREE.Vector3(0, 0, 0));\r\n\r\n        this.textDiv.id = \"markerArrowMesh\";\r\n\r\n        this.textDiv.style.fontFamily = \"Arial\";\r\n\r\n        this.textDiv.style.display = \"none\";\r\n\r\n        this.textDiv.style.padding = \"4px\";\r\n\r\n        this.textDiv.style.backgroundColor = \"rgba(0, 0, 0, 0.5)\";\r\n\r\n        this.textDiv.style.letterSpacing = \"2px\";\r\n\r\n        this.textDiv.style.border = \"1px solid rgba(255, 255, 255, 0.5)\";\r\n\r\n        this.textDiv.style.borderRadius = \"5px\";\r\n    }\r\n\r\n    /**\r\n     * 添加鼠标事件\r\n     */\r\n    addMouseEvent() {\r\n\r\n        this.mesh.mouseDown = (e, obj) => {\r\n\r\n            this.mouseDownBoo = true;\r\n\r\n            this.startPoint.x = e.clientX;\r\n\r\n            this.startPoint.y = e.clientY;\r\n        }\r\n\r\n        this.mesh.mouseUp = (e, obj) => {\r\n\r\n            if (this.mouseDownBoo) {\r\n\r\n                let v3 = new THREE.Vector2(e.clientX, e.clientY);\r\n\r\n                let boo = v3.equals(this.startPoint);\r\n\r\n                this.mouseDownBoo = false;\r\n\r\n                if (boo) {\r\n                    let store = initStore();\r\n                    let url;\r\n                    switch (this.markerObj.type) { //点击弹出的表现形式 1-图文 2-图片 3-三维 4-视频 5-书籍 6-音频 7-环拍 999-跳站点\r\n                        case 1:\r\n                        case 2:\r\n                            let allExhibits = constants.c_allExhibitsForBuildingTable.getValues();\r\n\r\n                            allExhibits.forEach((item) => {\r\n\r\n                                if (item.markerID.indexOf(obj.object.userData.markerID) != -1) {\r\n\r\n                                    if (!constants.c_multiDataByParentIDTable.containsKey(item.exhibitID)) {\r\n\r\n                                        if (this.markerObj.type == 1) {\r\n\r\n                                            this.showMarkerUI(item,[]);\r\n                                            \r\n                                        }\r\n\r\n                                        constants.sw_getService.getMultiDataByParentID(item.exhibitID, this.markerObj.type);\r\n\r\n                                    } else {\r\n\r\n                                        let imageArr = constants.c_multiDataByParentIDTable.getValue(item.exhibitID);\r\n\r\n                                        if (this.markerObj.type == 1) {\r\n\r\n                                            this.showMarkerUI(item,imageArr);\r\n                                            \r\n                                        } else {\r\n\r\n                                            let markerImgList = [],\r\n                                                markerthumbs = [];\r\n\r\n                                            imageArr.forEach((item) => {\r\n                                                let imgUrl = `${constants.sw_getService.resourcesUrl}/${item.filePath}`;\r\n\r\n                                                let arr1 = item.filePath.split('/');\r\n\r\n                                                let pp = `${constants.sw_getService.resourcesUrl}/${arr1[0]}/${arr1[1]}/${arr1[2]}/phone/${arr1[3]}`;\r\n\r\n                                                markerImgList.push(imgUrl);\r\n\r\n                                                markerthumbs.push(pp);\r\n                                            });\r\n                                            store.dispatch(show_ViewPicture_fun({\r\n                                                off: true,\r\n                                                idx: 0,\r\n                                                imageList: markerImgList,\r\n                                                thumbs: markerthumbs\r\n                                            }));\r\n                                        }\r\n                                    }\r\n                                }\r\n                            });\r\n                            break;\r\n                        case 3:\r\n                            url = constants.sw_getService.resourcesUrl + \"/BusinessData/ExhibitDetails/3DModel/\" + this.markerObj.markerID + \".html\";\r\n\r\n                            store.dispatch(show_Iframe_fun({\r\n                                iframeOff: true,\r\n                                iframeUrl: url\r\n                            }));\r\n                            break;\r\n                        case 4:\r\n                            store.dispatch(show_VideoBox_fun({\r\n                                off: true,\r\n                                videoUrl: this.markerObj.name\r\n                            }));\r\n                            break;\r\n                        case 5:\r\n                            url = constants.sw_getService.resourcesUrl + \"/BusinessData/ExhibitDetails/Book/\" + this.markerObj.markerID + \"/index.html\";\r\n\r\n                            store.dispatch(show_Iframe_fun({\r\n                                iframeOff: true,\r\n                                iframeUrl: url\r\n                            }));\r\n                            break;\r\n                        case 999:\r\n                            jumpSite(this.markerObj.name);\r\n                            break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        //鼠标进入\r\n        this.mesh.mouseOver = (e, obj) => {\r\n\r\n            this.showTextDiv(obj, this.markerObj.name);\r\n\r\n        }\r\n\r\n        //出去\r\n        this.mesh.mouseOut = (e, obj) => {\r\n\r\n            this.hideTextDiv();\r\n\r\n        }\r\n\r\n    }\r\n\r\n    /**显示标注UI界面 */\r\n    showMarkerUI(item,imageArr){\r\n        let store = initStore();\r\n        store.dispatch(show_MarkerInterface_fun({\r\n            off: true,\r\n            exhibitID:item.exhibitID,\r\n            imglist: imageArr,\r\n            title: item.name,\r\n            content: item.description,\r\n            d3: item.featuresList[0],\r\n            video: item.featuresList[1],\r\n            audio: item.featuresList[2],\r\n            book: item.featuresList[3],\r\n            links: item.featuresList[4],\r\n            likeNum: item.likes\r\n        }));\r\n        constants.c_likeToExhibitID = item.exhibitID;\r\n        constants.sw_getService.GetLikesForExhibitID(item.exhibitID);//获取点赞数\r\n        constants.sw_getService.GetNewestComment(item.exhibitID);//获取最新20条评论\r\n    }\r\n\r\n    /**\r\n     * 不停的更新动画\r\n     * @param {Number} delta 补帧时间\r\n     */\r\n    update(delta) {\r\n        if (this.textureAnimator && this.markerType == 2) {\r\n\r\n            this.textureAnimator.update(1000 * delta);\r\n\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 显示标注文本说明\r\n     * @param {Object} obj 射线返回对象\r\n     * @param {String} str 显示文本\r\n     */\r\n    showTextDiv(obj, str) {\r\n        if (str && str != \"\") {\r\n\r\n            this.textDiv.style.display = \"block\";\r\n\r\n            var labelPos = getWorldToScene(obj.point);\r\n\r\n            this.textDiv.style.left = labelPos.x + \"px\";\r\n\r\n            this.textDiv.style.top = (labelPos.y - 40) + \"px\";\r\n\r\n            this.textDiv.innerHTML = str;\r\n\r\n        }\r\n    }\r\n\r\n\r\n    /**隐藏标注说明文本 */\r\n    hideTextDiv() {\r\n\r\n        this.textDiv.style.display = \"none\";\r\n\r\n    }\r\n\r\n    /**清空对象 */\r\n    clear() {\r\n\r\n        this.textureAnimator = null;\r\n\r\n        delectTextDiv(this.textDiv);\r\n\r\n        disposeNode(this.mesh);\r\n    }\r\n}\r\n\r\nexport default SWMarkerModule;"]}]}