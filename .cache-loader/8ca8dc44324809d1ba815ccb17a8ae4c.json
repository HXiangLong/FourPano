{"remainingRequest":"D:\\02数文\\WebProject\\NodeAllProject\\FourPano\\node_modules\\babel-loader\\lib\\index.js?cacheDirectory=true!D:\\02数文\\WebProject\\NodeAllProject\\FourPano\\app\\src\\module\\marker\\SWMarkerModule.js","dependencies":[{"path":"D:\\02数文\\WebProject\\NodeAllProject\\FourPano\\app\\src\\module\\marker\\SWMarkerModule.js","mtime":1539658409126},{"path":"D:\\02数文\\WebProject\\NodeAllProject\\FourPano\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1538971317145},{"path":"D:\\02数文\\WebProject\\NodeAllProject\\FourPano\\node_modules\\babel-loader\\lib\\index.js","mtime":1520329890000}],"contextDependencies":[],"result":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }(); /* global THREE,$*/\n\nvar _SWTool = require('../../tool/SWTool');\n\nvar _SWTextureAnimator = require('../../tool/SWTextureAnimator');\n\nvar _SWTextureAnimator2 = _interopRequireDefault(_SWTextureAnimator);\n\nvar _store = require('../../../views/redux/store/store');\n\nvar _store2 = _interopRequireDefault(_store);\n\nvar _action = require('../../../views/redux/action');\n\nvar _SWInitializeInstance = require('../../tool/SWInitializeInstance');\n\nvar _SWConstants = require('../../tool/SWConstants');\n\nvar constants = _interopRequireWildcard(_SWConstants);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n/**\r\n * 全景除了底层盒子、UI 都是标注\r\n * 这是所有标注的父类\r\n */\nvar SWMarkerModule = function () {\n    /**\r\n     * \r\n     * @param {String} url 图片链接地址\r\n     * @param {Number} type 1-静态 2-动态 \r\n     * @param {Object} obj {fpsNum:帧数，wPlane:宽，hPlane：高}\r\n     */\n    function SWMarkerModule(url, type, obj) {\n        _classCallCheck(this, SWMarkerModule);\n\n        this.markerType = type;\n\n        this.mouseDownBoo = false;\n\n        this.startPoint = new THREE.Vector2();\n\n        if (url) {\n            this.texture = new THREE.ImageUtils.loadTexture(url);\n        }\n\n        if (obj) {\n            this.textureAnimator = new _SWTextureAnimator2.default(this.texture, obj.fpsNum, 1, obj.fpsNum, 100);\n\n            this.geometry = new THREE.PlaneGeometry(obj.wPlane, obj.hPlane, 1, 1);\n\n            this.material = new THREE.MeshBasicMaterial({\n                map: this.texture,\n                side: 2,\n                transparent: true,\n                opacity: 1\n            });\n        } else {\n\n            this.geometry = new THREE.PlaneGeometry(1, 1, 1, 1);\n\n            this.material = new THREE.MeshBasicMaterial({\n                color: 0xFFFFFF\n            });\n        }\n\n        this.mesh = new THREE.Mesh(this.geometry, this.material);\n\n        this.textDiv = new _SWTool.TextDiv(new THREE.Vector3(0, 0, 0), 12, \"\");\n        this.textDiv.id = \"markerMesh\";\n        this.textDiv.style.display = \"none\";\n        this.textDiv.style.color = \"#FFF\";\n        this.textDiv.style.borderRadius = \"3px\";\n        this.textDiv.style.backgroundColor = \"rgba(16, 16, 16, 0.3)\";\n        this.textDiv.style.padding = \"3px 10px\";\n        this.textDiv.style.letterSpacing = \"2px\";\n    }\n\n    /**\r\n     * 添加鼠标事件\r\n     */\n\n\n    _createClass(SWMarkerModule, [{\n        key: 'addMouseEvent',\n        value: function addMouseEvent() {\n            var _this = this;\n\n            this.mesh.mouseDown = function (e, obj) {\n\n                _this.mouseDownBoo = true;\n\n                _this.startPoint.x = e.clientX;\n\n                _this.startPoint.y = e.clientY;\n            };\n\n            this.mesh.mouseUp = function (e, obj) {\n\n                if (_this.mouseDownBoo) {\n\n                    var v3 = new THREE.Vector2(e.clientX, e.clientY);\n\n                    var boo = v3.equals(_this.startPoint);\n\n                    _this.mouseDownBoo = false;\n\n                    if (boo) {\n                        var store = (0, _store2.default)();\n                        var url = void 0;\n                        switch (_this.markerObj.type) {//点击弹出的表现形式 1-图文 2-图片 3-三维 4-视频 5-书籍 6-音频 7-环拍 999-跳站点\n                            case 1:\n                            case 2:\n                                var allExhibits = constants.c_allExhibitsForBuildingTable.getValues();\n\n                                allExhibits.forEach(function (item) {\n\n                                    if (item.markerID.indexOf(obj.object.userData.markerID) != -1) {\n\n                                        if (!constants.c_multiDataByParentIDTable.containsKey(item.exhibitID)) {\n\n                                            if (_this.markerObj.type == 1) {\n                                                store.dispatch((0, _action.show_MarkerInterface_fun)({\n                                                    off: true,\n                                                    exhibitID: item.exhibitID,\n                                                    title: item.name,\n                                                    content: item.description,\n                                                    d3: item.sceneID[0],\n                                                    video: item.sceneID[1],\n                                                    audio: item.sceneID[2],\n                                                    book: item.sceneID[3]\n                                                }));\n                                            }\n\n                                            constants.sw_getService.getMultiDataByParentID(item.exhibitID, _this.markerObj.type);\n                                        } else {\n\n                                            var imageArr = constants.c_multiDataByParentIDTable.getValue(item.exhibitID);\n\n                                            if (_this.markerObj.type == 1) {\n                                                store.dispatch((0, _action.show_MarkerInterface_fun)({\n                                                    off: true,\n                                                    exhibitID: item.exhibitID,\n                                                    imglist: imageArr,\n                                                    title: item.name,\n                                                    content: item.description,\n                                                    links: \"https://www.baidu.com\",\n                                                    d3: item.sceneID[0],\n                                                    video: item.sceneID[1],\n                                                    audio: item.sceneID[2],\n                                                    book: item.sceneID[3]\n                                                }));\n                                            } else {\n\n                                                var markerImgList = [],\n                                                    markerthumbs = [];\n\n                                                imageArr.forEach(function (item) {\n                                                    var imgUrl = constants.sw_getService.resourcesUrl + '/' + item.filePath;\n\n                                                    var arr1 = item.filePath.split('/');\n\n                                                    var pp = constants.sw_getService.resourcesUrl + '/' + arr1[0] + '/' + arr1[1] + '/' + arr1[2] + '/phone/' + arr1[3];\n\n                                                    markerImgList.push(imgUrl);\n\n                                                    markerthumbs.push(pp);\n                                                });\n                                                store.dispatch((0, _action.show_ViewPicture_fun)({\n                                                    off: true,\n                                                    idx: 0,\n                                                    imageList: markerImgList,\n                                                    thumbs: markerthumbs\n                                                }));\n                                            }\n                                        }\n                                    }\n                                });\n                                break;\n                            case 3:\n                                url = constants.sw_getService.resourcesUrl + \"/BusinessData/ExhibitDetails/3DModel/\" + _this.markerObj.markerID + \".html\";\n\n                                store.dispatch((0, _action.show_Iframe_fun)({\n                                    iframeOff: true,\n                                    iframeUrl: url\n                                }));\n                                break;\n                            case 4:\n                                store.dispatch((0, _action.show_VideoBox_fun)({\n                                    off: true,\n                                    videoUrl: _this.markerObj.name\n                                }));\n                                break;\n                            case 5:\n                                url = constants.sw_getService.resourcesUrl + \"/BusinessData/ExhibitDetails/Book/\" + _this.markerObj.markerID + \"/index.html\";\n\n                                store.dispatch((0, _action.show_Iframe_fun)({\n                                    iframeOff: true,\n                                    iframeUrl: url\n                                }));\n                                break;\n                            case 999:\n                                (0, _SWInitializeInstance.jumpSite)(_this.markerObj.name);\n                                break;\n                        }\n                    }\n                }\n            };\n\n            //鼠标进入\n            this.mesh.mouseOver = function (e, obj) {\n\n                _this.showTextDiv(obj, _this.markerObj.name);\n            };\n\n            //出去\n            this.mesh.mouseOut = function (e, obj) {\n\n                _this.hideTextDiv();\n            };\n        }\n\n        /**\r\n         * 不停的更新动画\r\n         * @param {Number} delta 补帧时间\r\n         */\n\n    }, {\n        key: 'update',\n        value: function update(delta) {\n            if (this.textureAnimator && this.markerType == 2) {\n\n                this.textureAnimator.update(1000 * delta);\n            }\n        }\n\n        /**\r\n         * 显示标注文本说明\r\n         * @param {Object} obj 射线返回对象\r\n         * @param {String} str 显示文本\r\n         */\n\n    }, {\n        key: 'showTextDiv',\n        value: function showTextDiv(obj, str) {\n            if (str && str != \"\") {\n\n                this.textDiv.style.display = \"block\";\n\n                var labelPos = (0, _SWTool.getWorldToScene)(obj.point);\n\n                this.textDiv.style.left = labelPos.x - 30 + \"px\";\n\n                this.textDiv.style.top = labelPos.y - 40 + \"px\";\n\n                this.textDiv.innerHTML = str;\n            }\n        }\n\n        /**隐藏标注说明文本 */\n\n    }, {\n        key: 'hideTextDiv',\n        value: function hideTextDiv() {\n\n            this.textDiv.style.display = \"none\";\n        }\n\n        /**清空对象 */\n\n    }, {\n        key: 'clear',\n        value: function clear() {\n\n            this.textureAnimator = null;\n\n            (0, _SWTool.delectTextDiv)(this.textDiv);\n\n            (0, _SWTool.disposeNode)(this.mesh);\n        }\n    }]);\n\n    return SWMarkerModule;\n}();\n\nexports.default = SWMarkerModule;",{"version":3,"sources":["app\\src\\module\\marker\\SWMarkerModule.js"],"names":["constants","SWMarkerModule","url","type","obj","markerType","mouseDownBoo","startPoint","THREE","Vector2","texture","ImageUtils","loadTexture","textureAnimator","SWTextureAnimator","fpsNum","geometry","PlaneGeometry","wPlane","hPlane","material","MeshBasicMaterial","map","side","transparent","opacity","color","mesh","Mesh","textDiv","TextDiv","Vector3","id","style","display","borderRadius","backgroundColor","padding","letterSpacing","mouseDown","e","x","clientX","y","clientY","mouseUp","v3","boo","equals","store","markerObj","allExhibits","c_allExhibitsForBuildingTable","getValues","forEach","item","markerID","indexOf","object","userData","c_multiDataByParentIDTable","containsKey","exhibitID","dispatch","off","title","name","content","description","d3","sceneID","video","audio","book","sw_getService","getMultiDataByParentID","imageArr","getValue","imglist","links","markerImgList","markerthumbs","imgUrl","resourcesUrl","filePath","arr1","split","pp","push","idx","imageList","thumbs","iframeOff","iframeUrl","videoUrl","mouseOver","showTextDiv","mouseOut","hideTextDiv","delta","update","str","labelPos","point","left","top","innerHTML"],"mappings":"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","file":"SWMarkerModule.js","sourceRoot":"D:\\02数文\\WebProject\\NodeAllProject\\FourPano","sourcesContent":["/* global THREE,$*/\r\n\r\nimport {\r\n    disposeNode,\r\n    TextDiv,\r\n    getWorldToScene,\r\n    delectTextDiv\r\n} from '../../tool/SWTool'\r\nimport SWTextureAnimator from '../../tool/SWTextureAnimator';\r\nimport initStore from '../../../views/redux/store/store';\r\nimport {\r\n    show_Iframe_fun,\r\n    show_VideoBox_fun,\r\n    show_MarkerInterface_fun,\r\n    show_ViewPicture_fun\r\n} from '../../../views/redux/action';\r\nimport {\r\n    jumpSite\r\n} from '../../tool/SWInitializeInstance';\r\nimport * as constants from '../../tool/SWConstants';\r\n\r\n/**\r\n * 全景除了底层盒子、UI 都是标注\r\n * 这是所有标注的父类\r\n */\r\nclass SWMarkerModule {\r\n    /**\r\n     * \r\n     * @param {String} url 图片链接地址\r\n     * @param {Number} type 1-静态 2-动态 \r\n     * @param {Object} obj {fpsNum:帧数，wPlane:宽，hPlane：高}\r\n     */\r\n    constructor(url, type, obj) {\r\n\r\n        this.markerType = type;\r\n\r\n        this.mouseDownBoo = false;\r\n\r\n        this.startPoint = new THREE.Vector2();\r\n\r\n        if (url) {\r\n            this.texture = new THREE.ImageUtils.loadTexture(url);\r\n        }\r\n\r\n        if (obj) {\r\n            this.textureAnimator = new SWTextureAnimator(this.texture, obj.fpsNum, 1, obj.fpsNum, 100);\r\n\r\n            this.geometry = new THREE.PlaneGeometry(obj.wPlane, obj.hPlane, 1, 1);\r\n\r\n            this.material = new THREE.MeshBasicMaterial({\r\n                map: this.texture,\r\n                side: 2,\r\n                transparent: true,\r\n                opacity: 1\r\n            });\r\n\r\n        } else {\r\n\r\n            this.geometry = new THREE.PlaneGeometry(1, 1, 1, 1);\r\n\r\n            this.material = new THREE.MeshBasicMaterial({\r\n                color: 0xFFFFFF\r\n            });\r\n\r\n        }\r\n\r\n        this.mesh = new THREE.Mesh(this.geometry, this.material);\r\n\r\n        this.textDiv = new TextDiv(new THREE.Vector3(0, 0, 0), 12, \"\");\r\n        this.textDiv.id = \"markerMesh\";\r\n        this.textDiv.style.display = \"none\";\r\n        this.textDiv.style.color = \"#FFF\";\r\n        this.textDiv.style.borderRadius = \"3px\";\r\n        this.textDiv.style.backgroundColor = \"rgba(16, 16, 16, 0.3)\";\r\n        this.textDiv.style.padding = \"3px 10px\";\r\n        this.textDiv.style.letterSpacing = \"2px\";\r\n    }\r\n\r\n    /**\r\n     * 添加鼠标事件\r\n     */\r\n    addMouseEvent() {\r\n\r\n        this.mesh.mouseDown = (e, obj) => {\r\n\r\n            this.mouseDownBoo = true;\r\n\r\n            this.startPoint.x = e.clientX;\r\n\r\n            this.startPoint.y = e.clientY;\r\n        }\r\n\r\n        this.mesh.mouseUp = (e, obj) => {\r\n\r\n            if (this.mouseDownBoo) {\r\n\r\n                let v3 = new THREE.Vector2(e.clientX, e.clientY);\r\n\r\n                let boo = v3.equals(this.startPoint);\r\n\r\n                this.mouseDownBoo = false;\r\n\r\n                if (boo) {\r\n                    let store = initStore();\r\n                    let url;\r\n                    switch (this.markerObj.type) { //点击弹出的表现形式 1-图文 2-图片 3-三维 4-视频 5-书籍 6-音频 7-环拍 999-跳站点\r\n                        case 1:\r\n                        case 2:\r\n                            let allExhibits = constants.c_allExhibitsForBuildingTable.getValues();\r\n\r\n                            allExhibits.forEach((item) => {\r\n\r\n                                if (item.markerID.indexOf(obj.object.userData.markerID) != -1) {\r\n\r\n                                    if (!constants.c_multiDataByParentIDTable.containsKey(item.exhibitID)) {\r\n\r\n                                        if (this.markerObj.type == 1) {\r\n                                            store.dispatch(show_MarkerInterface_fun({\r\n                                                off: true,\r\n                                                exhibitID:item.exhibitID,\r\n                                                title: item.name,\r\n                                                content: item.description,\r\n                                                d3: item.sceneID[0],\r\n                                                video: item.sceneID[1],\r\n                                                audio: item.sceneID[2],\r\n                                                book: item.sceneID[3]\r\n                                            }));\r\n                                        }\r\n\r\n                                        constants.sw_getService.getMultiDataByParentID(item.exhibitID, this.markerObj.type);\r\n\r\n                                    } else {\r\n\r\n                                        let imageArr = constants.c_multiDataByParentIDTable.getValue(item.exhibitID);\r\n\r\n                                        if (this.markerObj.type == 1) {\r\n                                            store.dispatch(show_MarkerInterface_fun({\r\n                                                off: true,\r\n                                                exhibitID:item.exhibitID,\r\n                                                imglist: imageArr,\r\n                                                title: item.name,\r\n                                                content: item.description,\r\n                                                links: \"https://www.baidu.com\",\r\n                                                d3: item.sceneID[0],\r\n                                                video: item.sceneID[1],\r\n                                                audio: item.sceneID[2],\r\n                                                book: item.sceneID[3]\r\n                                            }));\r\n\r\n                                        } else {\r\n\r\n                                            let markerImgList = [],\r\n                                                markerthumbs = [];\r\n\r\n                                            imageArr.forEach((item) => {\r\n                                                let imgUrl = `${constants.sw_getService.resourcesUrl}/${item.filePath}`;\r\n\r\n                                                let arr1 = item.filePath.split('/');\r\n\r\n                                                let pp = `${constants.sw_getService.resourcesUrl}/${arr1[0]}/${arr1[1]}/${arr1[2]}/phone/${arr1[3]}`;\r\n\r\n                                                markerImgList.push(imgUrl);\r\n\r\n                                                markerthumbs.push(pp);\r\n                                            });\r\n                                            store.dispatch(show_ViewPicture_fun({\r\n                                                off: true,\r\n                                                idx: 0,\r\n                                                imageList: markerImgList,\r\n                                                thumbs: markerthumbs\r\n                                            }));\r\n                                        }\r\n                                    }\r\n                                }\r\n                            });\r\n                            break;\r\n                        case 3:\r\n                            url = constants.sw_getService.resourcesUrl + \"/BusinessData/ExhibitDetails/3DModel/\" + this.markerObj.markerID + \".html\";\r\n\r\n                            store.dispatch(show_Iframe_fun({\r\n                                iframeOff: true,\r\n                                iframeUrl: url\r\n                            }));\r\n                            break;\r\n                        case 4:\r\n                            store.dispatch(show_VideoBox_fun({\r\n                                off: true,\r\n                                videoUrl: this.markerObj.name\r\n                            }));\r\n                            break;\r\n                        case 5:\r\n                            url = constants.sw_getService.resourcesUrl + \"/BusinessData/ExhibitDetails/Book/\" + this.markerObj.markerID + \"/index.html\";\r\n\r\n                            store.dispatch(show_Iframe_fun({\r\n                                iframeOff: true,\r\n                                iframeUrl: url\r\n                            }));\r\n                            break;\r\n                        case 999:\r\n                            jumpSite(this.markerObj.name);\r\n                            break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        //鼠标进入\r\n        this.mesh.mouseOver = (e, obj) => {\r\n\r\n            this.showTextDiv(obj, this.markerObj.name);\r\n\r\n        }\r\n\r\n        //出去\r\n        this.mesh.mouseOut = (e, obj) => {\r\n\r\n            this.hideTextDiv();\r\n\r\n        }\r\n\r\n    }\r\n\r\n    /**\r\n     * 不停的更新动画\r\n     * @param {Number} delta 补帧时间\r\n     */\r\n    update(delta) {\r\n        if (this.textureAnimator && this.markerType == 2) {\r\n\r\n            this.textureAnimator.update(1000 * delta);\r\n\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 显示标注文本说明\r\n     * @param {Object} obj 射线返回对象\r\n     * @param {String} str 显示文本\r\n     */\r\n    showTextDiv(obj, str) {\r\n        if (str && str != \"\") {\r\n\r\n            this.textDiv.style.display = \"block\";\r\n\r\n            var labelPos = getWorldToScene(obj.point);\r\n\r\n            this.textDiv.style.left = (labelPos.x - 30) + \"px\";\r\n\r\n            this.textDiv.style.top = (labelPos.y - 40) + \"px\";\r\n\r\n            this.textDiv.innerHTML = str;\r\n\r\n        }\r\n    }\r\n\r\n\r\n    /**隐藏标注说明文本 */\r\n    hideTextDiv() {\r\n\r\n        this.textDiv.style.display = \"none\";\r\n\r\n    }\r\n\r\n    /**清空对象 */\r\n    clear() {\r\n\r\n        this.textureAnimator = null;\r\n\r\n        delectTextDiv(this.textDiv);\r\n\r\n        disposeNode(this.mesh);\r\n    }\r\n}\r\n\r\nexport default SWMarkerModule;"]}]}