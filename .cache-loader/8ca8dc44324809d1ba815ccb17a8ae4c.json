{"remainingRequest":"D:\\02数文\\WebProject\\NodeAllProject\\FourPano\\node_modules\\babel-loader\\lib\\index.js?cacheDirectory=true!D:\\02数文\\WebProject\\NodeAllProject\\FourPano\\app\\src\\module\\marker\\SWMarkerModule.js","dependencies":[{"path":"D:\\02数文\\WebProject\\NodeAllProject\\FourPano\\app\\src\\module\\marker\\SWMarkerModule.js","mtime":1545901087921},{"path":"D:\\02数文\\WebProject\\NodeAllProject\\FourPano\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1540192322431},{"path":"D:\\02数文\\WebProject\\NodeAllProject\\FourPano\\node_modules\\babel-loader\\lib\\index.js","mtime":1520329890000}],"contextDependencies":[],"result":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }(); /* global THREE,$*/\n\nvar _SWTool = require('../../tool/SWTool');\n\nvar _SWTextureAnimator = require('../../tool/SWTextureAnimator');\n\nvar _SWTextureAnimator2 = _interopRequireDefault(_SWTextureAnimator);\n\nvar _store = require('../../../views/redux/store/store');\n\nvar _store2 = _interopRequireDefault(_store);\n\nvar _action = require('../../../views/redux/action');\n\nvar _SWInitializeInstance = require('../../tool/SWInitializeInstance');\n\nvar _SWConstants = require('../../tool/SWConstants');\n\nvar constants = _interopRequireWildcard(_SWConstants);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n/**\r\n * 全景除了底层盒子、UI 都是标注\r\n * 这是所有标注的父类\r\n */\nvar SWMarkerModule = function () {\n    /**\r\n     * \r\n     * @param {String} url 图片链接地址\r\n     * @param {Number} type 1-静态 2-动态 \r\n     * @param {Object} obj {fpsNum:帧数，wPlane:宽，hPlane：高}\r\n     */\n    function SWMarkerModule(url, type, obj) {\n        _classCallCheck(this, SWMarkerModule);\n\n        this.markerType = type;\n\n        this.mouseDownBoo = false;\n\n        this.startPoint = new THREE.Vector2();\n\n        if (url) {\n            this.texture = new THREE.ImageUtils.loadTexture(url);\n        }\n\n        if (obj) {\n            this.textureAnimator = new _SWTextureAnimator2.default(this.texture, obj.fpsNum, 1, obj.fpsNum, 100);\n\n            this.geometry = new THREE.PlaneGeometry(obj.wPlane, obj.hPlane, 1, 1);\n\n            this.material = new THREE.MeshBasicMaterial({\n                map: this.texture,\n                side: 2,\n                transparent: true,\n                opacity: 1\n            });\n        } else {\n\n            this.geometry = new THREE.PlaneGeometry(1, 1, 1, 1);\n\n            this.material = new THREE.MeshBasicMaterial({\n                color: 0xFFFFFF\n            });\n        }\n\n        this.mesh = new THREE.Mesh(this.geometry, this.material);\n\n        this.textDiv = new _SWTool.TextDiv(new THREE.Vector3(0, 0, 0));\n\n        this.textDiv.id = \"markerArrowMesh\";\n\n        this.textDiv.style.fontFamily = \"Arial\";\n\n        this.textDiv.style.display = \"none\";\n\n        this.textDiv.style.padding = \"4px\";\n\n        this.textDiv.style.backgroundColor = \"rgba(0, 0, 0, 0.5)\";\n\n        this.textDiv.style.letterSpacing = \"2px\";\n\n        this.textDiv.style.border = \"1px solid rgba(255, 255, 255, 0.5)\";\n\n        this.textDiv.style.borderRadius = \"5px\";\n    }\n\n    /**\r\n     * 添加鼠标事件\r\n     */\n\n\n    _createClass(SWMarkerModule, [{\n        key: 'addMouseEvent',\n        value: function addMouseEvent() {\n            var _this = this;\n\n            this.mesh.mouseDown = function (e, obj) {\n\n                _this.mouseDownBoo = true;\n\n                _this.startPoint.x = e.clientX;\n\n                _this.startPoint.y = e.clientY;\n            };\n\n            this.mesh.mouseUp = function (e, obj) {\n\n                if (_this.mouseDownBoo) {\n\n                    _this.hideTextDiv();\n\n                    var v3 = new THREE.Vector2(e.clientX, e.clientY);\n\n                    var boo = v3.equals(_this.startPoint);\n\n                    _this.mouseDownBoo = false;\n\n                    if (boo) {\n                        var store = (0, _store2.default)();\n                        var url = void 0;\n                        switch (_this.markerObj.type) {//点击弹出的表现形式 1-图文 2-图片 3-三维 4-视频 44-手机版嵌入视频 5-书籍 6-音频 7-环拍 999-跳站点\n                            case 1:\n                            case 2:\n                                if (constants.c_allExhibitsForMarkerTable.containsKey(obj.object.userData.markerID)) {\n\n                                    var _item = constants.c_allExhibitsForMarkerTable.getValue(obj.object.userData.markerID);\n\n                                    if (!constants.c_multiDataByParentIDTable.containsKey(_item.exhibitID)) {\n\n                                        if (_this.markerObj.type == 1) {\n\n                                            _this.showMarkerUI(_item, []);\n                                        }\n\n                                        constants.sw_getService.getMultiDataByParentID(_item.exhibitID, _this.markerObj.type);\n                                    } else {\n\n                                        var imageArr = constants.c_multiDataByParentIDTable.getValue(_item.exhibitID);\n\n                                        if (_this.markerObj.type == 1) {\n\n                                            _this.showMarkerUI(_item, imageArr);\n                                        } else {\n\n                                            var markerImgList = [],\n                                                markerthumbs = [];\n\n                                            imageArr.forEach(function (item) {\n\n                                                markerImgList.push(constants.c_currentState == constants.c_currentStateEnum.phoneStatus ? item.phoneMax : item.PCMax);\n\n                                                markerthumbs.push(item.thumbnail);\n                                            });\n                                            store.dispatch((0, _action.show_ViewPicture_fun)({\n                                                off: true,\n                                                idx: 0,\n                                                imageList: markerImgList,\n                                                thumbs: markerthumbs\n                                            }));\n                                        }\n                                    }\n                                }\n                                break;\n                            case 3:\n                                url = constants.sw_getService.resourcesUrl + '/BusinessData/ExhibitDetails/3DModel/' + _this.markerObj.markerID + '.html';\n                                _this.showIframeFun(store, url, _this.markerObj.name);\n                                break;\n                            case 4:\n                            case 44:\n                                store.dispatch((0, _action.show_VideoBox_fun)({\n                                    off: true,\n                                    videoUrl: _this.markerObj.name\n                                }));\n                                break;\n                            case 5:\n                                var item = constants.c_allExhibitsForMarkerTable.getValue(_this.markerObj.markerID);\n                                url = constants.sw_getService.resourcesUrl + '/BusinessData/ExhibitDetails/Book/' + _this.markerObj.markerID + '/index.html#page/' + item.displayPriority;\n                                _this.showIframeFun(store, url, _this.markerObj.name, 1);\n                                break;\n                            case 6:\n                                break;\n                            case 7:\n                                url = constants.sw_getService.resourcesUrl + '/BusinessData/ExhibitDetails/Ring/' + _this.markerObj.markerID + '.html';\n                                _this.showIframeFun(store, url, _this.markerObj.name);\n                                break;\n                            case 999:\n                                (0, _SWInitializeInstance.jumpSite)(_this.markerObj.name);\n                                break;\n                        }\n                    }\n                }\n            };\n\n            //鼠标进入\n            this.mesh.mouseOver = function (e, obj) {\n\n                _this.showTextDiv(obj, _this.markerObj.name);\n            };\n\n            //出去\n            this.mesh.mouseOut = function (e, obj) {\n\n                _this.hideTextDiv();\n            };\n        }\n\n        /**弹出iframe框或者跳出网页 */\n\n    }, {\n        key: 'showIframeFun',\n        value: function showIframeFun(store, url, names, type) {\n\n            if (constants.c_LowendMachine) {\n\n                var docURL = document.URL.indexOf(\"?\") != -1 ? document.URL.split('?')[0] : document.URL;\n                var str = type ? '#' : '';\n                var newUrl = '' + url + str + '?Source=' + docURL + '&PanoID=' + constants.c_StationInfo.panoID + '&dYaw=' + constants.sw_cameraManage.yaw_Camera + '&dPitch=' + constants.sw_cameraManage.picth_Camera;\n\n                if (constants.c_weixinQQWeibo) {\n                    window.open(newUrl);\n                } else {\n                    window.location.href = newUrl;\n                }\n            } else {\n\n                store.dispatch((0, _action.show_Iframe_fun)({\n                    iframeOff: true,\n                    iframeUrl: url,\n                    iframeName: names\n                }));\n            }\n        }\n\n        /**显示标注UI界面 */\n\n    }, {\n        key: 'showMarkerUI',\n        value: function showMarkerUI(item, imageArr) {\n            var store = (0, _store2.default)();\n            store.dispatch((0, _action.show_MarkerInterface_fun)({\n                off: true,\n                exhibitID: item.exhibitID,\n                imglist: imageArr,\n                title: item.name,\n                content: item.description,\n                d3: item.featuresList[0],\n                video: item.featuresList[1],\n                audio: item.featuresList[2],\n                book: item.featuresList[3],\n                links: item.featuresList[4],\n                likeNum: item.likes\n            }));\n            constants.c_likeToExhibitID = item.exhibitID;\n            constants.sw_getService.GetLikesForExhibitID(item.exhibitID); //获取点赞数\n            constants.sw_getService.GetNewestComment(item.exhibitID); //获取最新20条评论\n        }\n\n        /**\r\n         * 不停的更新动画\r\n         * @param {Number} delta 补帧时间\r\n         */\n\n    }, {\n        key: 'update',\n        value: function update(delta) {\n            if (this.textureAnimator && this.markerType == 2) {\n\n                this.textureAnimator.update(1000 * delta);\n            }\n        }\n\n        /**\r\n         * 显示标注文本说明\r\n         * @param {Object} obj 射线返回对象\r\n         * @param {String} str 显示文本\r\n         */\n\n    }, {\n        key: 'showTextDiv',\n        value: function showTextDiv(obj, str) {\n            if (str && str != \"\") {\n\n                this.textDiv.style.display = \"block\";\n\n                var labelPos = (0, _SWTool.getWorldToScene)(obj.point);\n\n                this.textDiv.style.left = labelPos.x + \"px\";\n\n                this.textDiv.style.top = labelPos.y - 40 + \"px\";\n\n                this.textDiv.innerHTML = str;\n            }\n        }\n\n        /**隐藏标注说明文本 */\n\n    }, {\n        key: 'hideTextDiv',\n        value: function hideTextDiv() {\n\n            this.textDiv.style.display = \"none\";\n        }\n\n        /**清空对象 */\n\n    }, {\n        key: 'clear',\n        value: function clear() {\n\n            this.textureAnimator = null;\n\n            (0, _SWTool.delectTextDiv)(this.textDiv);\n\n            (0, _SWTool.disposeNode)(this.mesh);\n        }\n    }]);\n\n    return SWMarkerModule;\n}();\n\nexports.default = SWMarkerModule;",{"version":3,"sources":["app\\src\\module\\marker\\SWMarkerModule.js"],"names":["constants","SWMarkerModule","url","type","obj","markerType","mouseDownBoo","startPoint","THREE","Vector2","texture","ImageUtils","loadTexture","textureAnimator","SWTextureAnimator","fpsNum","geometry","PlaneGeometry","wPlane","hPlane","material","MeshBasicMaterial","map","side","transparent","opacity","color","mesh","Mesh","textDiv","TextDiv","Vector3","id","style","fontFamily","display","padding","backgroundColor","letterSpacing","border","borderRadius","mouseDown","e","x","clientX","y","clientY","mouseUp","hideTextDiv","v3","boo","equals","store","markerObj","c_allExhibitsForMarkerTable","containsKey","object","userData","markerID","item","getValue","c_multiDataByParentIDTable","exhibitID","showMarkerUI","sw_getService","getMultiDataByParentID","imageArr","markerImgList","markerthumbs","forEach","push","c_currentState","c_currentStateEnum","phoneStatus","phoneMax","PCMax","thumbnail","dispatch","off","idx","imageList","thumbs","resourcesUrl","showIframeFun","name","videoUrl","displayPriority","mouseOver","showTextDiv","mouseOut","names","c_LowendMachine","docURL","document","URL","indexOf","split","str","newUrl","c_StationInfo","panoID","sw_cameraManage","yaw_Camera","picth_Camera","c_weixinQQWeibo","window","open","location","href","iframeOff","iframeUrl","iframeName","imglist","title","content","description","d3","featuresList","video","audio","book","links","likeNum","likes","c_likeToExhibitID","GetLikesForExhibitID","GetNewestComment","delta","update","labelPos","point","left","top","innerHTML"],"mappings":"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","file":"SWMarkerModule.js","sourceRoot":"D:\\02数文\\WebProject\\NodeAllProject\\FourPano","sourcesContent":["/* global THREE,$*/\r\n\r\nimport {\r\n    disposeNode,\r\n    TextDiv,\r\n    getWorldToScene,\r\n    delectTextDiv\r\n} from '../../tool/SWTool'\r\nimport SWTextureAnimator from '../../tool/SWTextureAnimator';\r\nimport initStore from '../../../views/redux/store/store';\r\nimport {\r\n    show_Iframe_fun,\r\n    show_VideoBox_fun,\r\n    show_MarkerInterface_fun,\r\n    show_ViewPicture_fun\r\n} from '../../../views/redux/action';\r\nimport {\r\n    jumpSite\r\n} from '../../tool/SWInitializeInstance';\r\nimport * as constants from '../../tool/SWConstants';\r\n\r\n/**\r\n * 全景除了底层盒子、UI 都是标注\r\n * 这是所有标注的父类\r\n */\r\nclass SWMarkerModule {\r\n    /**\r\n     * \r\n     * @param {String} url 图片链接地址\r\n     * @param {Number} type 1-静态 2-动态 \r\n     * @param {Object} obj {fpsNum:帧数，wPlane:宽，hPlane：高}\r\n     */\r\n    constructor(url, type, obj) {\r\n\r\n        this.markerType = type;\r\n\r\n        this.mouseDownBoo = false;\r\n\r\n        this.startPoint = new THREE.Vector2();\r\n\r\n        if (url) {\r\n            this.texture = new THREE.ImageUtils.loadTexture(url);\r\n        }\r\n\r\n        if (obj) {\r\n            this.textureAnimator = new SWTextureAnimator(this.texture, obj.fpsNum, 1, obj.fpsNum, 100);\r\n\r\n            this.geometry = new THREE.PlaneGeometry(obj.wPlane, obj.hPlane, 1, 1);\r\n\r\n            this.material = new THREE.MeshBasicMaterial({\r\n                map: this.texture,\r\n                side: 2,\r\n                transparent: true,\r\n                opacity: 1\r\n            });\r\n\r\n        } else {\r\n\r\n            this.geometry = new THREE.PlaneGeometry(1, 1, 1, 1);\r\n\r\n            this.material = new THREE.MeshBasicMaterial({\r\n                color: 0xFFFFFF\r\n            });\r\n\r\n        }\r\n\r\n        this.mesh = new THREE.Mesh(this.geometry, this.material);\r\n\r\n        this.textDiv = new TextDiv(new THREE.Vector3(0, 0, 0));\r\n\r\n        this.textDiv.id = \"markerArrowMesh\";\r\n\r\n        this.textDiv.style.fontFamily = \"Arial\";\r\n\r\n        this.textDiv.style.display = \"none\";\r\n\r\n        this.textDiv.style.padding = \"4px\";\r\n\r\n        this.textDiv.style.backgroundColor = \"rgba(0, 0, 0, 0.5)\";\r\n\r\n        this.textDiv.style.letterSpacing = \"2px\";\r\n\r\n        this.textDiv.style.border = \"1px solid rgba(255, 255, 255, 0.5)\";\r\n\r\n        this.textDiv.style.borderRadius = \"5px\";\r\n    }\r\n\r\n    /**\r\n     * 添加鼠标事件\r\n     */\r\n    addMouseEvent() {\r\n\r\n        this.mesh.mouseDown = (e, obj) => {\r\n\r\n            this.mouseDownBoo = true;\r\n\r\n            this.startPoint.x = e.clientX;\r\n\r\n            this.startPoint.y = e.clientY;\r\n        }\r\n\r\n        this.mesh.mouseUp = (e, obj) => {\r\n\r\n            if (this.mouseDownBoo) {\r\n\r\n                this.hideTextDiv();\r\n\r\n                let v3 = new THREE.Vector2(e.clientX, e.clientY);\r\n\r\n                let boo = v3.equals(this.startPoint);\r\n\r\n                this.mouseDownBoo = false;\r\n\r\n                if (boo) {\r\n                    let store = initStore();\r\n                    let url;\r\n                    switch (this.markerObj.type) { //点击弹出的表现形式 1-图文 2-图片 3-三维 4-视频 44-手机版嵌入视频 5-书籍 6-音频 7-环拍 999-跳站点\r\n                        case 1:\r\n                        case 2:\r\n                            if (constants.c_allExhibitsForMarkerTable.containsKey(obj.object.userData.markerID)) {\r\n\r\n                                let item = constants.c_allExhibitsForMarkerTable.getValue(obj.object.userData.markerID);\r\n\r\n                                if (!constants.c_multiDataByParentIDTable.containsKey(item.exhibitID)) {\r\n\r\n                                    if (this.markerObj.type == 1) {\r\n\r\n                                        this.showMarkerUI(item, []);\r\n\r\n                                    }\r\n\r\n                                    constants.sw_getService.getMultiDataByParentID(item.exhibitID, this.markerObj.type);\r\n\r\n                                } else {\r\n\r\n                                    let imageArr = constants.c_multiDataByParentIDTable.getValue(item.exhibitID);\r\n\r\n                                    if (this.markerObj.type == 1) {\r\n\r\n                                        this.showMarkerUI(item, imageArr);\r\n\r\n                                    } else {\r\n\r\n                                        let markerImgList = [],\r\n                                            markerthumbs = [];\r\n\r\n                                        imageArr.forEach((item) => {\r\n\r\n                                            markerImgList.push(constants.c_currentState == constants.c_currentStateEnum.phoneStatus ? item.phoneMax : item.PCMax);\r\n\r\n                                            markerthumbs.push(item.thumbnail);\r\n                                        });\r\n                                        store.dispatch(show_ViewPicture_fun({\r\n                                            off: true,\r\n                                            idx: 0,\r\n                                            imageList: markerImgList,\r\n                                            thumbs: markerthumbs\r\n                                        }));\r\n                                    }\r\n                                }\r\n                            }\r\n                            break;\r\n                        case 3:\r\n                            url = `${constants.sw_getService.resourcesUrl}/BusinessData/ExhibitDetails/3DModel/${this.markerObj.markerID}.html`;\r\n                            this.showIframeFun(store, url, this.markerObj.name);\r\n                            break;\r\n                        case 4:\r\n                        case 44:\r\n                            store.dispatch(show_VideoBox_fun({\r\n                                off: true,\r\n                                videoUrl: this.markerObj.name\r\n                            }));\r\n                            break;\r\n                        case 5:\r\n                            let item = constants.c_allExhibitsForMarkerTable.getValue(this.markerObj.markerID);\r\n                            url = `${constants.sw_getService.resourcesUrl}/BusinessData/ExhibitDetails/Book/${this.markerObj.markerID}/index.html#page/${item.displayPriority}`;\r\n                            this.showIframeFun(store, url, this.markerObj.name, 1);\r\n                            break;\r\n                        case 6:\r\n                            break;\r\n                        case 7:\r\n                            url = `${constants.sw_getService.resourcesUrl}/BusinessData/ExhibitDetails/Ring/${this.markerObj.markerID}.html`;\r\n                            this.showIframeFun(store, url, this.markerObj.name);\r\n                            break;\r\n                        case 999:\r\n                            jumpSite(this.markerObj.name);\r\n                            break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        //鼠标进入\r\n        this.mesh.mouseOver = (e, obj) => {\r\n\r\n            this.showTextDiv(obj, this.markerObj.name);\r\n\r\n        }\r\n\r\n        //出去\r\n        this.mesh.mouseOut = (e, obj) => {\r\n\r\n            this.hideTextDiv();\r\n\r\n        }\r\n\r\n    }\r\n\r\n    /**弹出iframe框或者跳出网页 */\r\n    showIframeFun(store, url, names, type) {\r\n\r\n        if (constants.c_LowendMachine) {\r\n\r\n            let docURL = document.URL.indexOf(\"?\") != -1 ? document.URL.split('?')[0] : document.URL;\r\n            let str = type ? '#' : '';\r\n            let newUrl = `${url}${str}?Source=${docURL}&PanoID=${constants.c_StationInfo.panoID}&dYaw=${constants.sw_cameraManage.yaw_Camera}&dPitch=${constants.sw_cameraManage.picth_Camera}`;\r\n\r\n            if (constants.c_weixinQQWeibo) {\r\n                window.open(newUrl);\r\n            } else {\r\n                window.location.href = newUrl;\r\n            }\r\n\r\n        } else {\r\n\r\n            store.dispatch(show_Iframe_fun({\r\n                iframeOff: true,\r\n                iframeUrl: url,\r\n                iframeName: names\r\n            }));\r\n        }\r\n    }\r\n\r\n    /**显示标注UI界面 */\r\n    showMarkerUI(item, imageArr) {\r\n        let store = initStore();\r\n        store.dispatch(show_MarkerInterface_fun({\r\n            off: true,\r\n            exhibitID: item.exhibitID,\r\n            imglist: imageArr,\r\n            title: item.name,\r\n            content: item.description,\r\n            d3: item.featuresList[0],\r\n            video: item.featuresList[1],\r\n            audio: item.featuresList[2],\r\n            book: item.featuresList[3],\r\n            links: item.featuresList[4],\r\n            likeNum: item.likes\r\n        }));\r\n        constants.c_likeToExhibitID = item.exhibitID;\r\n        constants.sw_getService.GetLikesForExhibitID(item.exhibitID); //获取点赞数\r\n        constants.sw_getService.GetNewestComment(item.exhibitID); //获取最新20条评论\r\n    }\r\n\r\n    /**\r\n     * 不停的更新动画\r\n     * @param {Number} delta 补帧时间\r\n     */\r\n    update(delta) {\r\n        if (this.textureAnimator && this.markerType == 2) {\r\n\r\n            this.textureAnimator.update(1000 * delta);\r\n\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 显示标注文本说明\r\n     * @param {Object} obj 射线返回对象\r\n     * @param {String} str 显示文本\r\n     */\r\n    showTextDiv(obj, str) {\r\n        if (str && str != \"\") {\r\n\r\n            this.textDiv.style.display = \"block\";\r\n\r\n            var labelPos = getWorldToScene(obj.point);\r\n\r\n            this.textDiv.style.left = labelPos.x + \"px\";\r\n\r\n            this.textDiv.style.top = (labelPos.y - 40) + \"px\";\r\n\r\n            this.textDiv.innerHTML = str;\r\n\r\n        }\r\n    }\r\n\r\n\r\n    /**隐藏标注说明文本 */\r\n    hideTextDiv() {\r\n\r\n        this.textDiv.style.display = \"none\";\r\n\r\n    }\r\n\r\n    /**清空对象 */\r\n    clear() {\r\n\r\n        this.textureAnimator = null;\r\n\r\n        delectTextDiv(this.textDiv);\r\n\r\n        disposeNode(this.mesh);\r\n    }\r\n}\r\n\r\nexport default SWMarkerModule;"]}]}