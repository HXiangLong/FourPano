{"remainingRequest":"D:\\02数文\\WebProject\\NodeAllProject\\FourPano\\node_modules\\babel-loader\\lib\\index.js?cacheDirectory=true!D:\\02数文\\WebProject\\NodeAllProject\\FourPano\\app\\src\\SWPano.js","dependencies":[{"path":"D:\\02数文\\WebProject\\NodeAllProject\\FourPano\\app\\src\\SWPano.js","mtime":1545613688518},{"path":"D:\\02数文\\WebProject\\NodeAllProject\\FourPano\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1540192322431},{"path":"D:\\02数文\\WebProject\\NodeAllProject\\FourPano\\node_modules\\babel-loader\\lib\\index.js","mtime":1520329890000}],"contextDependencies":[],"result":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }(); /* global THREE,$ */\n\nvar _SWConstants = require('./tool/SWConstants');\n\nvar constants = _interopRequireWildcard(_SWConstants);\n\nvar _Stats = require('./libs/Stats');\n\nvar _Stats2 = _interopRequireDefault(_Stats);\n\nvar _SWServerData = require('./server/SWServerData');\n\nvar _SWServerData2 = _interopRequireDefault(_SWServerData);\n\nvar _SWGetSQLData = require('./server/SWGetSQLData');\n\nvar _SWGetSQLData2 = _interopRequireDefault(_SWGetSQLData);\n\nvar _SWCameraModule = require('./module/SWCameraModule');\n\nvar _SWCameraModule2 = _interopRequireDefault(_SWCameraModule);\n\nvar _SWBoxJumpModule = require('./module/panoBox/SWBoxJumpModule');\n\nvar _SWBoxJumpModule2 = _interopRequireDefault(_SWBoxJumpModule);\n\nvar _SWMouseModule = require('./module/SWMouseModule');\n\nvar _SWMouseModule2 = _interopRequireDefault(_SWMouseModule);\n\nvar _SWWallModule = require('./module/laser/SWWallModule');\n\nvar _SWWallModule2 = _interopRequireDefault(_SWWallModule);\n\nvar _SWGroundModule = require('./module/laser/SWGroundModule');\n\nvar _SWGroundModule2 = _interopRequireDefault(_SWGroundModule);\n\nvar _SWWallSurfaceModule = require('./module/laser/SWWallSurfaceModule');\n\nvar _SWWallSurfaceModule2 = _interopRequireDefault(_SWWallSurfaceModule);\n\nvar _SWWallSiteSurfaceModule = require('./module/laser/SWWallSiteSurfaceModule');\n\nvar _SWWallSiteSurfaceModule2 = _interopRequireDefault(_SWWallSiteSurfaceModule);\n\nvar _SWMeasureModule = require('./module/draw/SWMeasureModule');\n\nvar _SWMeasureModule2 = _interopRequireDefault(_SWMeasureModule);\n\nvar _SWMarkerTakePictureModule = require('./module/marker/SWMarkerTakePictureModule');\n\nvar _SWMarkerTakePictureModule2 = _interopRequireDefault(_SWMarkerTakePictureModule);\n\nvar _SWRoamingModule = require('./module/roaming/SWRoamingModule');\n\nvar _SWRoamingModule2 = _interopRequireDefault(_SWRoamingModule);\n\nvar _SWReticle = require('./tool/SWReticle');\n\nvar _SWReticle2 = _interopRequireDefault(_SWReticle);\n\nvar _store = require('../views/redux/store/store');\n\nvar _store2 = _interopRequireDefault(_store);\n\nvar _action = require('../views/redux/action');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar TWEEN = require('@tweenjs/tween.js');\nrequire('./libs/controls/DeviceOrientationControls');\nrequire('./libs/controls/OrbitControls');\nrequire('./libs/controls/CardboardEffect');\nrequire('./libs/controls/StereoEffect');\n\nvar SWPano = function () {\n    function SWPano() {\n        _classCallCheck(this, SWPano);\n\n        //监听界面是否失去焦点，停止所有声音\n        document.addEventListener(\"visibilitychange\", this.handleVisibilityChange.bind(this), false);\n        //监听屏幕是否变化\n        window.addEventListener('resize', this.onWindowResize.bind(this), false);\n    }\n\n    /**页面失去焦点之后做出了相应改变 */\n\n\n    _createClass(SWPano, [{\n        key: 'handleVisibilityChange',\n        value: function handleVisibilityChange() {\n\n            var store = (0, _store2.default)();\n\n            if (document.hidden) {\n                // 用户按home，或者锁屏\n                store.dispatch((0, _action.background_music_fun)({\n                    bgMusicOff: false\n                }));\n\n                store.dispatch((0, _action.show_VideoBox_fun)({\n                    videoOff: false\n                }));\n\n                constants.c_smallVideoArr.forEach(function (obj) {\n                    if (obj.panoID == constants.c_StationInfo.panoID) {\n                        obj.stopVideo();\n                    }\n                });\n            } else {\n                var vboo = false;\n                var storeObj = store.getState();\n\n                if (storeObj.OpenVideoBox.off) {\n                    //视频弹出框优先等级最高\n                    store.dispatch((0, _action.show_VideoBox_fun)({\n                        videoOff: true\n                    }));\n                } else {\n                    constants.c_smallVideoArr.forEach(function (obj) {\n                        //嵌入视频其次\n                        if (obj.panoID == constants.c_StationInfo.panoID) {\n                            obj.playVideo();\n                            vboo = true;\n                        }\n                    });\n                }\n\n                if (!vboo) {\n                    store.dispatch((0, _action.background_music_fun)({ //背景音乐最次\n                        bgMusicOff: true\n                    }));\n                }\n            }\n        }\n\n        /**检测浏览器是否支持webgl */\n\n    }, {\n        key: 'webglAvailable',\n        value: function webglAvailable() {\n            try {\n                var canvas = document.createElement('canvas');\n                return !!(window.WebGLRenderingContext && (canvas.getContext('webgl') || canvas.getContext('experimental-webgl')));\n            } catch (e) {\n                return false;\n            }\n        }\n\n        /**屏幕分辨率变化 */\n\n    }, {\n        key: 'onWindowResize',\n        value: function onWindowResize() {\n            constants.c_clientWidth = window.innerWidth;\n            constants.c_clientHeight = window.innerHeight;\n            constants.camera.aspect = constants.c_clientWidth / constants.c_clientHeight;\n            constants.camera.updateProjectionMatrix();\n            if (constants.c_currentState != constants.c_currentStateEnum.phoneStatus) constants.renderer.setPixelRatio(window.devicePixelRatio);\n            constants.renderer.setSize(constants.c_clientWidth, constants.c_clientHeight);\n        }\n\n        /**性能监测*/\n\n    }, {\n        key: 'initStats',\n        value: function initStats() {\n            constants.stats = new _Stats2.default();\n            constants.stats.setMode(0); // 0: fps, 1: ms\n            constants.stats.domElement.style.position = 'absolute';\n            constants.stats.domElement.style.left = '0px';\n            constants.stats.domElement.style.top = '0px';\n            document.getElementById(\"Stats-output\").appendChild(constants.stats.domElement);\n        }\n\n        /**初始化相机*/\n\n    }, {\n        key: 'initCamera',\n        value: function initCamera() {\n            constants.c_clientWidth = window.innerWidth;\n            constants.c_clientHeight = window.innerHeight;\n            constants.camera = new THREE.PerspectiveCamera(constants.c_Maxfov, constants.c_clientWidth / constants.c_clientHeight, 0.1, 10000);\n\n            //创建6个渲染到WebGLRenderTargetCube的相机。\n            //near - 近裁剪距离。 far - 裁剪距离远。 cubeResolution - 设置立方体边缘的长度\n            constants.cubeCamera = new THREE.CubeCamera(1, 10000, constants.c_FaceDistance * 0.5);\n            constants.cubeCamera.renderTarget.texture.minFilter = THREE.LinearMipMapLinearFilter;\n            constants.scene.add(constants.cubeCamera);\n        }\n\n        /**初始化灯光*/\n\n    }, {\n        key: 'initLight',\n        value: function initLight() {\n            constants.ambientLight = new THREE.AmbientLight(0xFFFFFF, 1);\n            constants.scene.add(constants.ambientLight);\n        }\n\n        /**初始化场景*/\n\n    }, {\n        key: 'initScene',\n        value: function initScene() {\n            constants.scene = new THREE.Scene();\n        }\n\n        /**初始化渲染*/\n\n    }, {\n        key: 'initRenderer',\n        value: function initRenderer() {\n            // if (this.webglAvailable()) {\n            constants.renderer = new THREE.WebGLRenderer({\n                antialias: true\n            });\n            // } else {\n            // constants.renderer = new THREE.CanvasRenderer();\n            // }\n            if (constants.c_currentState == constants.c_currentStateEnum.phoneStatus) {\n                constants.renderer.setPixelRatio(constants.c_devicePixelRatio);\n            }\n            constants.renderer.setSize(window.innerWidth, window.innerHeight);\n            document.getElementById('canvas3d').appendChild(constants.renderer.domElement);\n            constants.renderer.domElement.style.position = \"absolute\";\n            constants.renderer.domElement.style.display = \"block\";\n            //设置canvas背景色(clearColor)\n            constants.renderer.setClearColor(0xffffff, 1.0);\n            constants.renderer.shadowMapEnabled = true;\n        }\n\n        /**初始化CSS渲染 */\n\n    }, {\n        key: 'initCSSRenderer',\n        value: function initCSSRenderer() {\n            var container = document.getElementById('canvas3d');\n            constants.renderer = new THREE.CSS3DRenderer();\n            constants.renderer.setSize(window.innerWidth, window.innerHeight);\n            constants.renderer.domElement.style.position = 'absolute';\n            constants.renderer.domElement.style.top = 0;\n            container.appendChild(constants.renderer.domElement);\n        }\n\n        /**每帧调用*/\n\n    }, {\n        key: 'Animate',\n        value: function Animate() {\n            if (constants.stats) constants.stats.update();\n\n            TWEEN.update();\n\n            this.Update();\n\n            if (constants.c_mode == constants.c_modes.NORMAL) {\n\n                constants.renderer.render(constants.scene, constants.camera);\n\n                constants.renderer.setSize(window.innerWidth, window.innerHeight);\n            } else {\n\n                constants.c_effect.render(constants.scene, constants.camera);\n            }\n        }\n\n        /**其他需要更新的都在这里*/\n\n    }, {\n        key: 'Update',\n        value: function Update() {\n\n            //计时器\n            var delta = constants.c_clock.getDelta();\n\n            //漫游\n            if (constants.sw_roamingModule) constants.sw_roamingModule.update();\n\n            //相机旋转\n            if (constants.sw_cameraManage) constants.sw_cameraManage.update();\n\n            //箭头动画\n            constants.c_arrowArr.forEach(function (item) {\n                item.update(delta);\n            });\n\n            //标注\n            constants.c_markerMeshArr.forEach(function (item) {\n                item.update(delta);\n            });\n\n            //讲解视频、电视视频\n            constants.c_smallVideoArr.forEach(function (markerVideo) {\n                markerVideo.updataSmallVideo();\n            });\n\n            /**陀螺仪控制器 */\n            if (constants.c_control) constants.c_control.update();\n\n            /**鼠标控制器 */\n            if (constants.sw_mouseControl) constants.sw_mouseControl.update();\n        }\n\n        /**初始化读取数据对象*/\n\n    }, {\n        key: 'initService',\n        value: function initService() {\n            constants.sw_GetSQLData = new _SWGetSQLData2.default();\n            constants.sw_getService = new _SWServerData2.default();\n        }\n\n        /**初始化相机控制对象*/\n\n    }, {\n        key: 'initCameraManage',\n        value: function initCameraManage() {\n            constants.sw_cameraManage = new _SWCameraModule2.default();\n        }\n\n        /**初始化天空盒子*/\n\n    }, {\n        key: 'initSkyBox',\n        value: function initSkyBox() {\n            constants.sw_skyBox = new _SWBoxJumpModule2.default();\n        }\n\n        /**初始化鼠标操作控件*/\n\n    }, {\n        key: 'initMouseModule',\n        value: function initMouseModule() {\n            var canvas = document.getElementById('canvas3d');\n            constants.sw_mouseControl = new _SWMouseModule2.default(canvas);\n        }\n\n        /**墙片初始化 */\n\n    }, {\n        key: 'initWallModule',\n        value: function initWallModule() {\n            constants.sw_wallMesh = new _SWWallModule2.default();\n            constants.sw_groundMesh = new _SWGroundModule2.default();\n            constants.sw_wallProbeSurface = constants.c_siteRepresentation ? new _SWWallSurfaceModule2.default() : new _SWWallSiteSurfaceModule2.default();\n            constants.sw_measure = new _SWMeasureModule2.default();\n        }\n\n        /**漫游程序初始化 */\n\n    }, {\n        key: 'initRoaming',\n        value: function initRoaming() {\n            constants.sw_roamingModule = new _SWRoamingModule2.default();\n        }\n\n        /**初始化编辑版需要的内容 */\n\n    }, {\n        key: 'initEditor',\n        value: function initEditor() {\n            constants.sw_markPoint = new _SWMarkerTakePictureModule2.default();\n        }\n\n        /**初始化VR */\n\n    }, {\n        key: 'initVR',\n        value: function initVR() {\n            constants.c_effect = new THREE.StereoEffect(constants.renderer);\n            constants.c_effect.setSize(window.innerWidth, window.innerHeight);\n        }\n\n        /**初始化十字 */\n\n    }, {\n        key: 'initReticle',\n        value: function initReticle() {\n            constants.sw_SWReticle = new _SWReticle2.default();\n            constants.sw_SWReticle.position.z = -10;\n            constants.camera.add(constants.sw_SWReticle);\n            constants.scene.add(constants.camera);\n        }\n\n        /**初始化控制 */\n\n    }, {\n        key: 'initControls',\n        value: function initControls() {\n            var container = document.getElementById('canvas3d');\n            constants.c_control = new THREE.DeviceOrientationControls(constants.camera, container);\n            constants.c_control.name = 'device-orientation';\n            constants.c_control.enabled = false;\n        }\n    }]);\n\n    return SWPano;\n}();\n\nexports.default = SWPano;",null]}