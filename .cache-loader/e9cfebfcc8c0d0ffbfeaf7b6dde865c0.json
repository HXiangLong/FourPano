{"remainingRequest":"D:\\02数文\\WebProject\\NodeAllProject\\FourPano\\node_modules\\babel-loader\\lib\\index.js?cacheDirectory=true!D:\\02数文\\WebProject\\NodeAllProject\\FourPano\\app\\src\\SWPano.js","dependencies":[{"path":"D:\\02数文\\WebProject\\NodeAllProject\\FourPano\\app\\src\\SWPano.js","mtime":1541385063539},{"path":"D:\\02数文\\WebProject\\NodeAllProject\\FourPano\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1540192322431},{"path":"D:\\02数文\\WebProject\\NodeAllProject\\FourPano\\node_modules\\babel-loader\\lib\\index.js","mtime":1520329890000}],"contextDependencies":[],"result":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }(); /* global THREE,$ */\n\nvar _SWConstants = require('./tool/SWConstants');\n\nvar constants = _interopRequireWildcard(_SWConstants);\n\nvar _Stats = require('./libs/Stats');\n\nvar _Stats2 = _interopRequireDefault(_Stats);\n\nvar _SWServerData = require('./server/SWServerData');\n\nvar _SWServerData2 = _interopRequireDefault(_SWServerData);\n\nvar _SWCameraModule = require('./module/SWCameraModule');\n\nvar _SWCameraModule2 = _interopRequireDefault(_SWCameraModule);\n\nvar _SWBoxJumpModule = require('./module/panoBox/SWBoxJumpModule');\n\nvar _SWBoxJumpModule2 = _interopRequireDefault(_SWBoxJumpModule);\n\nvar _SWMouseModule = require('./module/SWMouseModule');\n\nvar _SWMouseModule2 = _interopRequireDefault(_SWMouseModule);\n\nvar _SWWallModule = require('./module/laser/SWWallModule');\n\nvar _SWWallModule2 = _interopRequireDefault(_SWWallModule);\n\nvar _SWGroundModule = require('./module/laser/SWGroundModule');\n\nvar _SWGroundModule2 = _interopRequireDefault(_SWGroundModule);\n\nvar _SWWallSurfaceModule = require('./module/laser/SWWallSurfaceModule');\n\nvar _SWWallSurfaceModule2 = _interopRequireDefault(_SWWallSurfaceModule);\n\nvar _SWMeasureModule = require('./module/draw/SWMeasureModule');\n\nvar _SWMeasureModule2 = _interopRequireDefault(_SWMeasureModule);\n\nvar _SWMarkerTakePictureModule = require('./module/marker/SWMarkerTakePictureModule');\n\nvar _SWMarkerTakePictureModule2 = _interopRequireDefault(_SWMarkerTakePictureModule);\n\nvar _SWRoamingModule = require('./module/roaming/SWRoamingModule');\n\nvar _SWRoamingModule2 = _interopRequireDefault(_SWRoamingModule);\n\nvar _store = require('../views/redux/store/store');\n\nvar _store2 = _interopRequireDefault(_store);\n\nvar _action = require('../views/redux/action');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar TWEEN = require('@tweenjs/tween.js');\n\nvar SWPano = function () {\n    function SWPano() {\n        _classCallCheck(this, SWPano);\n\n        //监听界面是否失去焦点，停止所有声音\n        document.addEventListener(\"visibilitychange\", this.handleVisibilityChange.bind(this), false);\n        //监听屏幕是否变化\n        window.addEventListener('resize', this.onWindowResize.bind(this), false);\n    }\n\n    /**页面失去焦点之后做出了相应改变 */\n\n\n    _createClass(SWPano, [{\n        key: 'handleVisibilityChange',\n        value: function handleVisibilityChange() {\n\n            var store = (0, _store2.default)();\n\n            if (document.hidden) {\n                // 用户按home，或者锁屏\n                store.dispatch((0, _action.background_music_fun)({\n                    bgMusicOff: false\n                }));\n\n                store.dispatch((0, _action.show_VideoBox_fun)({\n                    videoOff: false\n                }));\n\n                constants.c_smallVideoArr.forEach(function (obj) {\n                    if (obj.panoID == constants.c_StationInfo.panoID) {\n                        obj.stopVideo();\n                    }\n                });\n            } else {\n                var vboo = false;\n                var storeObj = store.getState();\n\n                if (storeObj.OpenVideoBox.off) {\n                    //视频弹出框优先等级最高\n                    store.dispatch((0, _action.show_VideoBox_fun)({\n                        videoOff: true\n                    }));\n                } else {\n                    constants.c_smallVideoArr.forEach(function (obj) {\n                        //嵌入视频其次\n                        if (obj.panoID == constants.c_StationInfo.panoID) {\n                            obj.playVideo();\n                            vboo = true;\n                        }\n                    });\n                }\n\n                if (!vboo) {\n                    store.dispatch((0, _action.background_music_fun)({ //背景音乐最次\n                        bgMusicOff: true\n                    }));\n                }\n            }\n        }\n\n        /**检测浏览器是否支持webgl */\n\n    }, {\n        key: 'webglAvailable',\n        value: function webglAvailable() {\n            try {\n                var canvas = document.createElement('canvas');\n                return !!(window.WebGLRenderingContext && (canvas.getContext('webgl') || canvas.getContext('experimental-webgl')));\n            } catch (e) {\n                return false;\n            }\n        }\n\n        /**屏幕分辨率变化 */\n\n    }, {\n        key: 'onWindowResize',\n        value: function onWindowResize() {\n            constants.camera.aspect = window.innerWidth / window.innerHeight;\n            constants.camera.updateProjectionMatrix();\n            if (constants.c_currentState != constants.c_currentStateEnum.phoneStatus) constants.renderer.setPixelRatio(window.devicePixelRatio);\n            constants.renderer.setSize(window.innerWidth, window.innerHeight);\n        }\n\n        /**性能监测*/\n\n    }, {\n        key: 'initStats',\n        value: function initStats() {\n            constants.stats = new _Stats2.default();\n            constants.stats.setMode(0); // 0: fps, 1: ms\n            constants.stats.domElement.style.position = 'absolute';\n            constants.stats.domElement.style.left = '0px';\n            constants.stats.domElement.style.top = '0px';\n            document.getElementById(\"Stats-output\").appendChild(constants.stats.domElement);\n        }\n\n        /**初始化相机*/\n\n    }, {\n        key: 'initCamera',\n        value: function initCamera() {\n            constants.camera = new THREE.PerspectiveCamera(constants.c_Maxfov, window.innerWidth / window.innerHeight, 0.1, 10000);\n\n            //创建6个渲染到WebGLRenderTargetCube的相机。\n            //near - 近裁剪距离。 far - 裁剪距离远。 cubeResolution - 设置立方体边缘的长度\n            constants.cubeCamera = new THREE.CubeCamera(1, 10000, constants.c_FaceDistance * 0.5);\n            constants.cubeCamera.renderTarget.texture.minFilter = THREE.LinearMipMapLinearFilter;\n            constants.scene.add(constants.cubeCamera);\n        }\n\n        /**初始化灯光*/\n\n    }, {\n        key: 'initLight',\n        value: function initLight() {\n            constants.ambientLight = new THREE.AmbientLight(0xFFFFFF, 1);\n            constants.scene.add(constants.ambientLight);\n        }\n\n        /**初始化场景*/\n\n    }, {\n        key: 'initScene',\n        value: function initScene() {\n            constants.scene = new THREE.Scene();\n        }\n\n        /**初始化渲染*/\n\n    }, {\n        key: 'initRenderer',\n        value: function initRenderer() {\n            // if (this.webglAvailable()) {\n            constants.renderer = new THREE.WebGLRenderer({\n                antialias: true,\n                logarithmicDepthBuffer: true,\n                alpha: true\n            });\n            // } else {\n            // constants.renderer = new THREE.CanvasRenderer();\n            // }\n            constants.renderer.setSize(window.innerWidth, window.innerHeight);\n            document.getElementById('canvas3d').appendChild(constants.renderer.domElement);\n            constants.renderer.domElement.style.position = \"absolute\";\n            constants.renderer.domElement.style.display = \"block\";\n            //设置canvas背景色(clearColor)\n            constants.renderer.setClearColor(0xffffff, 1.0);\n            constants.renderer.shadowMapEnabled = true;\n            // constants.renderer.vr.enabled = true;\n\n            // checkAvailability();\n        }\n\n        /**初始化CSS渲染 */\n\n    }, {\n        key: 'initCSSRenderer',\n        value: function initCSSRenderer() {\n            var container = document.getElementById('canvas3d');\n            constants.renderer = new THREE.CSS3DRenderer();\n            constants.renderer.setSize(window.innerWidth, window.innerHeight);\n            constants.renderer.domElement.style.position = 'absolute';\n            constants.renderer.domElement.style.top = 0;\n            container.appendChild(constants.renderer.domElement);\n        }\n\n        /**每帧调用*/\n\n    }, {\n        key: 'Animate',\n        value: function Animate() {\n            if (constants.stats) constants.stats.update();\n\n            TWEEN.update();\n\n            this.Update();\n\n            constants.renderer.render(constants.scene, constants.camera);\n        }\n\n        /**其他需要更新的都在这里*/\n\n    }, {\n        key: 'Update',\n        value: function Update() {\n\n            //计时器\n            var delta = constants.c_clock.getDelta();\n\n            //漫游\n            if (constants.sw_roamingModule) constants.sw_roamingModule.update();\n\n            //相机旋转\n            if (constants.sw_cameraManage) constants.sw_cameraManage.update();\n\n            //箭头动画\n            constants.c_arrowArr.forEach(function (item) {\n\n                item.update(delta);\n            });\n\n            constants.c_markerMeshArr.forEach(function (item) {\n                item.update(delta);\n            });\n\n            //讲解视频、电视视频\n            constants.c_smallVideoArr.forEach(function (markerVideo) {\n                markerVideo.updataSmallVideo();\n            });\n        }\n\n        /**初始化读取数据对象*/\n\n    }, {\n        key: 'initService',\n        value: function initService() {\n            constants.sw_getService = new _SWServerData2.default();\n            constants.sw_getService.getConfig();\n        }\n\n        /**初始化相机控制对象*/\n\n    }, {\n        key: 'initCameraManage',\n        value: function initCameraManage() {\n            constants.sw_cameraManage = new _SWCameraModule2.default();\n        }\n\n        /**初始化天空盒子*/\n\n    }, {\n        key: 'initSkyBox',\n        value: function initSkyBox() {\n            constants.sw_skyBox = new _SWBoxJumpModule2.default();\n        }\n\n        /**初始化鼠标操作控件*/\n\n    }, {\n        key: 'initMouseModule',\n        value: function initMouseModule() {\n            var canvas = document.getElementById('canvas3d');\n            constants.sw_mouseControl = new _SWMouseModule2.default(canvas);\n        }\n\n        /**墙片初始化 */\n\n    }, {\n        key: 'initWallModule',\n        value: function initWallModule() {\n            constants.sw_wallMesh = new _SWWallModule2.default();\n            constants.sw_groundMesh = new _SWGroundModule2.default();\n            constants.sw_wallProbeSurface = new _SWWallSurfaceModule2.default();\n            constants.sw_measure = new _SWMeasureModule2.default();\n        }\n\n        /**漫游程序初始化 */\n\n    }, {\n        key: 'initRoaming',\n        value: function initRoaming() {\n            constants.sw_roamingModule = new _SWRoamingModule2.default();\n        }\n\n        /**初始化编辑版需要的内容 */\n\n    }, {\n        key: 'initEditor',\n        value: function initEditor() {\n            constants.sw_markPoint = new _SWMarkerTakePictureModule2.default();\n        }\n    }]);\n\n    return SWPano;\n}();\n\nexports.default = SWPano;\n\n\nfunction getVRDisplays(onDisplay) {\n\n    if ('getVRDisplays' in navigator) {\n\n        navigator.getVRDisplays().then(function (displays) {\n            onDisplay(displays[0]);\n        });\n    }\n}\n\n// getVRDisplay(function (display) {\n//     renderer.vr.setDevice(display);\n// });\n\nfunction checkAvailability() {\n    return new Promise(function (resolve, reject) {\n        if (navigator.getVRDisplays !== undefined) {\n            navigator.getVRDisplays().then(function (displays) {\n                if (displays.length === 0) {\n                    reject('no vr');\n                } else {\n                    resolve();\n                }\n            });\n        } else {\n            reject('no vr');\n        }\n    });\n}",{"version":3,"sources":["app\\src\\SWPano.js"],"names":["constants","TWEEN","require","SWPano","document","addEventListener","handleVisibilityChange","bind","window","onWindowResize","store","hidden","dispatch","bgMusicOff","videoOff","c_smallVideoArr","forEach","obj","panoID","c_StationInfo","stopVideo","vboo","storeObj","getState","OpenVideoBox","off","playVideo","canvas","createElement","WebGLRenderingContext","getContext","e","camera","aspect","innerWidth","innerHeight","updateProjectionMatrix","c_currentState","c_currentStateEnum","phoneStatus","renderer","setPixelRatio","devicePixelRatio","setSize","stats","Stats","setMode","domElement","style","position","left","top","getElementById","appendChild","THREE","PerspectiveCamera","c_Maxfov","cubeCamera","CubeCamera","c_FaceDistance","renderTarget","texture","minFilter","LinearMipMapLinearFilter","scene","add","ambientLight","AmbientLight","Scene","WebGLRenderer","antialias","logarithmicDepthBuffer","alpha","display","setClearColor","shadowMapEnabled","container","CSS3DRenderer","update","Update","render","delta","c_clock","getDelta","sw_roamingModule","sw_cameraManage","c_arrowArr","item","c_markerMeshArr","markerVideo","updataSmallVideo","sw_getService","serverData","getConfig","SWCameraModule","sw_skyBox","SWBoxJumpModule","sw_mouseControl","SWMouseModule","sw_wallMesh","SWWallModule","sw_groundMesh","SWGroundModule","sw_wallProbeSurface","SWWallSurfaceModule","sw_measure","SWMeasureModule","SWRoamingModule","sw_markPoint","SWMarkerTakePictureModule","getVRDisplays","onDisplay","navigator","then","displays","checkAvailability","Promise","resolve","reject","undefined","length"],"mappings":"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","file":"SWPano.js","sourceRoot":"D:\\02数文\\WebProject\\NodeAllProject\\FourPano","sourcesContent":["/* global THREE,$ */\r\n\r\nimport * as constants from \"./tool/SWConstants\";\r\nimport Stats from './libs/Stats';\r\nimport serverData from './server/SWServerData';\r\nimport SWCameraModule from './module/SWCameraModule'\r\nimport SWBoxJumpModule from './module/panoBox/SWBoxJumpModule'\r\nimport SWMouseModule from './module/SWMouseModule'\r\nimport SWWallModule from \"./module/laser/SWWallModule\";\r\nimport SWGroundModule from \"./module/laser/SWGroundModule\";\r\nimport SWWallSurfaceModule from \"./module/laser/SWWallSurfaceModule\";\r\nimport SWMeasureModule from './module/draw/SWMeasureModule';\r\nimport SWMarkerTakePictureModule from \"./module/marker/SWMarkerTakePictureModule\";\r\nimport SWRoamingModule from \"./module/roaming/SWRoamingModule\";\r\nimport initStore from '../views/redux/store/store';\r\nimport {\r\n    background_music_fun,\r\n    show_VideoBox_fun\r\n} from '../views/redux/action';\r\n\r\nconst TWEEN = require('@tweenjs/tween.js');\r\n\r\nclass SWPano {\r\n    constructor() {\r\n        //监听界面是否失去焦点，停止所有声音\r\n        document.addEventListener(\"visibilitychange\", this.handleVisibilityChange.bind(this), false);\r\n        //监听屏幕是否变化\r\n        window.addEventListener('resize', this.onWindowResize.bind(this), false);\r\n    }\r\n\r\n    /**页面失去焦点之后做出了相应改变 */\r\n    handleVisibilityChange() {\r\n\r\n        let store = initStore();\r\n\r\n        if (document.hidden) { // 用户按home，或者锁屏\r\n            store.dispatch(background_music_fun({\r\n                bgMusicOff: false\r\n            }));\r\n\r\n            store.dispatch(show_VideoBox_fun({\r\n                videoOff: false\r\n            }));\r\n\r\n            constants.c_smallVideoArr.forEach((obj) => {\r\n                if (obj.panoID == constants.c_StationInfo.panoID) {\r\n                    obj.stopVideo();\r\n                }\r\n            });\r\n\r\n        } else {\r\n            let vboo = false;\r\n            let storeObj = store.getState();\r\n\r\n            if (storeObj.OpenVideoBox.off) { //视频弹出框优先等级最高\r\n                store.dispatch(show_VideoBox_fun({\r\n                    videoOff: true\r\n                }));\r\n            } else {\r\n                constants.c_smallVideoArr.forEach((obj) => { //嵌入视频其次\r\n                    if (obj.panoID == constants.c_StationInfo.panoID) {\r\n                        obj.playVideo();\r\n                        vboo = true;\r\n                    }\r\n                });\r\n            }\r\n\r\n            if (!vboo) {\r\n                store.dispatch(background_music_fun({ //背景音乐最次\r\n                    bgMusicOff: true\r\n                }));\r\n            }\r\n        }\r\n    }\r\n\r\n    /**检测浏览器是否支持webgl */\r\n    webglAvailable() {\r\n        try {\r\n            let canvas = document.createElement('canvas');\r\n            return !!(window.WebGLRenderingContext && (\r\n                canvas.getContext('webgl') ||\r\n                canvas.getContext('experimental-webgl')));\r\n        } catch (e) {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /**屏幕分辨率变化 */\r\n    onWindowResize() {\r\n        constants.camera.aspect = window.innerWidth / window.innerHeight;\r\n        constants.camera.updateProjectionMatrix();\r\n        if (constants.c_currentState != constants.c_currentStateEnum.phoneStatus) constants.renderer.setPixelRatio(window.devicePixelRatio);\r\n        constants.renderer.setSize(window.innerWidth, window.innerHeight);\r\n    }\r\n\r\n    /**性能监测*/\r\n    initStats() {\r\n        constants.stats = new Stats();\r\n        constants.stats.setMode(0); // 0: fps, 1: ms\r\n        constants.stats.domElement.style.position = 'absolute';\r\n        constants.stats.domElement.style.left = '0px';\r\n        constants.stats.domElement.style.top = '0px';\r\n        document.getElementById(\"Stats-output\").appendChild(constants.stats.domElement);\r\n    }\r\n\r\n    /**初始化相机*/\r\n    initCamera() {\r\n        constants.camera = new THREE.PerspectiveCamera(constants.c_Maxfov, window.innerWidth / window.innerHeight, 0.1, 10000);\r\n\r\n        //创建6个渲染到WebGLRenderTargetCube的相机。\r\n        //near - 近裁剪距离。 far - 裁剪距离远。 cubeResolution - 设置立方体边缘的长度\r\n        constants.cubeCamera = new THREE.CubeCamera(1, 10000, constants.c_FaceDistance * 0.5);\r\n        constants.cubeCamera.renderTarget.texture.minFilter = THREE.LinearMipMapLinearFilter;\r\n        constants.scene.add(constants.cubeCamera);\r\n    }\r\n\r\n    /**初始化灯光*/\r\n    initLight() {\r\n        constants.ambientLight = new THREE.AmbientLight(0xFFFFFF, 1);\r\n        constants.scene.add(constants.ambientLight);\r\n    }\r\n\r\n    /**初始化场景*/\r\n    initScene() {\r\n        constants.scene = new THREE.Scene();\r\n    }\r\n\r\n    /**初始化渲染*/\r\n    initRenderer() {\r\n        // if (this.webglAvailable()) {\r\n        constants.renderer = new THREE.WebGLRenderer({\r\n            antialias: true,\r\n            logarithmicDepthBuffer: true,\r\n            alpha: true\r\n        });\r\n        // } else {\r\n        // constants.renderer = new THREE.CanvasRenderer();\r\n        // }\r\n        constants.renderer.setSize(window.innerWidth, window.innerHeight);\r\n        document.getElementById('canvas3d').appendChild(constants.renderer.domElement);\r\n        constants.renderer.domElement.style.position = \"absolute\";\r\n        constants.renderer.domElement.style.display = \"block\";\r\n        //设置canvas背景色(clearColor)\r\n        constants.renderer.setClearColor(0xffffff, 1.0);\r\n        constants.renderer.shadowMapEnabled = true;\r\n        // constants.renderer.vr.enabled = true;\r\n\r\n        // checkAvailability();\r\n    }\r\n\r\n    /**初始化CSS渲染 */\r\n    initCSSRenderer() {\r\n        let container = document.getElementById('canvas3d');\r\n        constants.renderer = new THREE.CSS3DRenderer();\r\n        constants.renderer.setSize(window.innerWidth, window.innerHeight);\r\n        constants.renderer.domElement.style.position = 'absolute';\r\n        constants.renderer.domElement.style.top = 0;\r\n        container.appendChild(constants.renderer.domElement);\r\n    }\r\n\r\n    /**每帧调用*/\r\n    Animate() {\r\n        if (constants.stats) constants.stats.update();\r\n\r\n        TWEEN.update();\r\n\r\n        this.Update();\r\n\r\n        constants.renderer.render(constants.scene, constants.camera);\r\n\r\n    }\r\n\r\n    /**其他需要更新的都在这里*/\r\n    Update() {\r\n\r\n        //计时器\r\n        let delta = constants.c_clock.getDelta();\r\n\r\n        //漫游\r\n        if (constants.sw_roamingModule) constants.sw_roamingModule.update();\r\n\r\n        //相机旋转\r\n        if (constants.sw_cameraManage) constants.sw_cameraManage.update();\r\n\r\n        //箭头动画\r\n        constants.c_arrowArr.forEach((item) => {\r\n\r\n            item.update(delta);\r\n\r\n        });\r\n\r\n        constants.c_markerMeshArr.forEach((item) => {\r\n            item.update(delta);\r\n        })\r\n\r\n        //讲解视频、电视视频\r\n        constants.c_smallVideoArr.forEach((markerVideo) => {\r\n            markerVideo.updataSmallVideo();\r\n        });\r\n    }\r\n\r\n    /**初始化读取数据对象*/\r\n    initService() {\r\n        constants.sw_getService = new serverData();\r\n        constants.sw_getService.getConfig();\r\n    }\r\n\r\n    /**初始化相机控制对象*/\r\n    initCameraManage() {\r\n        constants.sw_cameraManage = new SWCameraModule();\r\n    }\r\n\r\n    /**初始化天空盒子*/\r\n    initSkyBox() {\r\n        constants.sw_skyBox = new SWBoxJumpModule();\r\n    }\r\n\r\n    /**初始化鼠标操作控件*/\r\n    initMouseModule() {\r\n        let canvas = document.getElementById('canvas3d');\r\n        constants.sw_mouseControl = new SWMouseModule(canvas);\r\n    }\r\n\r\n    /**墙片初始化 */\r\n    initWallModule() {\r\n        constants.sw_wallMesh = new SWWallModule();\r\n        constants.sw_groundMesh = new SWGroundModule();\r\n        constants.sw_wallProbeSurface = new SWWallSurfaceModule();\r\n        constants.sw_measure = new SWMeasureModule();\r\n    }\r\n\r\n    /**漫游程序初始化 */\r\n    initRoaming() {\r\n        constants.sw_roamingModule = new SWRoamingModule();\r\n    }\r\n\r\n    /**初始化编辑版需要的内容 */\r\n    initEditor() {\r\n        constants.sw_markPoint = new SWMarkerTakePictureModule();\r\n\r\n    }\r\n}\r\n\r\n\r\nexport default SWPano;\r\n\r\n\r\n\r\n\r\nfunction getVRDisplays(onDisplay) {\r\n\r\n    if ('getVRDisplays' in navigator) {\r\n\r\n        navigator.getVRDisplays()\r\n            .then(function (displays) {\r\n                onDisplay(displays[0]);\r\n            });\r\n\r\n    }\r\n\r\n}\r\n\r\n// getVRDisplay(function (display) {\r\n//     renderer.vr.setDevice(display);\r\n// });\r\n\r\nfunction checkAvailability() {\r\n    return new Promise(function (resolve, reject) {\r\n        if (navigator.getVRDisplays !== undefined) {\r\n            navigator.getVRDisplays().then(function (displays) {\r\n                if (displays.length === 0) {\r\n                    reject('no vr');\r\n                } else {\r\n                    resolve();\r\n                }\r\n            });\r\n        } else {\r\n            reject('no vr');\r\n        }\r\n    });\r\n}"]}]}